{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/joker/Desktop/ink/work/nft-holder/pages/detail/[id].tsx\",\n    _s = $RefreshSig$();\n\nimport { useRouter } from 'next/router';\nimport { useEffect, useState } from 'react';\nimport { Row, Col, Button, Table, notification, Space, Statistic, Spin, Tooltip, Tag } from 'antd';\nimport { ShareAltOutlined, DoubleRightOutlined, LoadingOutlined, ReloadOutlined } from '@ant-design/icons';\nimport { formatMoney } from 'accounting';\nimport moment from 'moment';\nimport useSWR from 'swr';\nimport Layout from '../../components/layout';\nimport Card from '../../components/card';\nimport PriceInput from '../../components/price-input';\nimport QuotedPriceModal from '../../components/quoted-price-modal';\nimport SellModal from '../../components/sell-modal';\nimport ShareModal from '../../components/share-modal';\nimport useMe from '../../hooks/use-me';\nimport useIsMobile from '../../hooks/use-is-mobile';\nimport fetcher from '../../lib/fetcher';\nimport { RecordItemTypeMap } from '../../typings/record';\nimport styles from '../../styles/detail.module.css';\nvar Countdown = Statistic.Countdown;\nexport var __N_SSP = true;\nexport default function Detail(_ref) {\n  _s();\n\n  var _cardData$creator,\n      _cardData$holder,\n      _this = this;\n\n  var cardData = _ref.cardData,\n      cardStatus = _ref.cardStatus;\n  var router = useRouter();\n  var query = router.query;\n\n  var _useMe = useMe(),\n      me = _useMe.me;\n\n  var isMobile = useIsMobile();\n\n  var _useState = useState([]),\n      records = _useState[0],\n      setRecords = _useState[1];\n\n  var _useState2 = useState(true),\n      hasMoreRecords = _useState2[0],\n      setHasMoreRecords = _useState2[1];\n\n  var _useState3 = useState(1),\n      recordsPage = _useState3[0],\n      setRecordsPage = _useState3[1];\n\n  var _useState4 = useState(),\n      price = _useState4[0],\n      setPrice = _useState4[1];\n\n  var _useState5 = useState(),\n      myOffer = _useState5[0],\n      setMyOffer = _useState5[1];\n\n  var _useState6 = useState(),\n      sellData = _useState6[0],\n      setSellData = _useState6[1];\n\n  var _useState7 = useState(false),\n      sendConfirmVisible = _useState7[0],\n      setSendConfirmVisible = _useState7[1];\n\n  var _useState8 = useState(false),\n      sellConfirmVisible = _useState8[0],\n      setSellConfirmVisible = _useState8[1];\n\n  var _useState9 = useState(false),\n      shareVisible = _useState9[0],\n      setShareVisible = _useState9[1];\n\n  var _useState10 = useState(false),\n      shouldSendRequest = _useState10[0],\n      setShouldSendRequest = _useState10[1];\n\n  var _useState11 = useState(false),\n      shouldSellRequest = _useState11[0],\n      setShouldSellRequest = _useState11[1];\n\n  var _useState12 = useState(false),\n      shouldFetchMyOffer = _useState12[0],\n      setShouldFetchMyOffer = _useState12[1];\n\n  var _useState13 = useState(true),\n      shouldFetchMoreRecords = _useState13[0],\n      setShouldFetchMoreRecords = _useState13[1];\n\n  var _useState14 = useState(false),\n      shouldPaymentRequest = _useState14[0],\n      setShouldPaymentRequest = _useState14[1]; // 是原始发布者/创作者\n\n\n  var isCreator = (me === null || me === void 0 ? void 0 : me.isLoggedIn) && me.id === (cardData === null || cardData === void 0 ? void 0 : (_cardData$creator = cardData.creator) === null || _cardData$creator === void 0 ? void 0 : _cardData$creator.id); // 是当前持有者\n\n  var isHolder = (me === null || me === void 0 ? void 0 : me.isLoggedIn) && me.id === (cardData === null || cardData === void 0 ? void 0 : (_cardData$holder = cardData.holder) === null || _cardData$holder === void 0 ? void 0 : _cardData$holder.id); // 是否已经出售\n\n  var hasBeenSold = cardStatus === 1; // 是否可以购买\n\n  var canPurchased = me !== null && me !== void 0 && me.isLoggedIn && hasBeenSold ? !isHolder : !isCreator;\n  useEffect(function () {\n    if (me !== null && me !== void 0 && me.isLoggedIn && !hasBeenSold) {\n      setShouldFetchMyOffer(true);\n    }\n  }, [hasBeenSold, me === null || me === void 0 ? void 0 : me.isLoggedIn]); // 加载更多交易记录请求\n\n  var _useSWR = useSWR(shouldFetchMoreRecords && hasMoreRecords ? \"/api/records?id=\".concat(query.id, \"&pageSize=20&current=\").concat(recordsPage) : null, {\n    revalidateOnFocus: false,\n    onSuccess: function onSuccess(data) {\n      setShouldFetchMoreRecords(false);\n\n      if (!data.length) {\n        setHasMoreRecords(false);\n        return;\n      }\n\n      setRecords(recordsPage === 1 ? data : records.concat(data));\n    }\n  }),\n      _useSWR$isValidating = _useSWR.isValidating,\n      fetchMoreRecordsValidating = _useSWR$isValidating === void 0 ? true : _useSWR$isValidating,\n      mutateFetchMoreRecords = _useSWR.mutate; // 查询自己是否已中标\n\n\n  var _useSWR2 = useSWR(me !== null && me !== void 0 && me.isLoggedIn && canPurchased ? \"/api/my/win?id=\".concat(query.id) : null, {\n    revalidateOnFocus: false\n  }),\n      hasWon = _useSWR2.data,\n      hasWonValidating = _useSWR2.isValidating; // 查询已出售给谁\n\n\n  var _useSWR3 = useSWR(!canPurchased && !fetchMoreRecordsValidating ? \"/api/selling?id=\".concat(query.id) : null, {\n    revalidateOnFocus: false\n  }),\n      selling = _useSWR3.data,\n      _useSWR3$isValidating = _useSWR3.isValidating,\n      sellingValidating = _useSWR3$isValidating === void 0 ? true : _useSWR3$isValidating; // 查询当前成交价\n\n\n  var _useSWR4 = useSWR(me !== null && me !== void 0 && me.isLoggedIn && hasBeenSold ? \"/api/final?id=\".concat(query.id) : null, {\n    revalidateOnFocus: false\n  }),\n      _final = _useSWR4.data; // 查询我的报价请求\n\n\n  var _useSWR5 = useSWR(shouldFetchMyOffer ? \"/api/my/offer?id=\".concat(query.id) : null, {\n    onSuccess: function onSuccess(data) {\n      if (data.price && data.expire) setMyOffer(data);\n      setShouldFetchMyOffer(false);\n    }\n  }),\n      _useSWR5$isValidating = _useSWR5.isValidating,\n      fetchMyOfferValidating = _useSWR5$isValidating === void 0 ? true : _useSWR5$isValidating,\n      mutateFetchMyOffer = _useSWR5.mutate; // 查询统计数据请求\n\n\n  var _useSWR6 = useSWR(\"/api/card/stat?id=\".concat(query.id), {\n    revalidateOnFocus: false\n  }),\n      statData = _useSWR6.data,\n      _useSWR6$isValidating = _useSWR6.isValidating,\n      fetchStatDataValidating = _useSWR6$isValidating === void 0 ? true : _useSWR6$isValidating,\n      mutateFetchStatData = _useSWR6.mutate; // 发送报价请求\n\n\n  var _useSWR7 = useSWR(shouldSendRequest ? '/api/offer' : null, function (url) {\n    return fetcher(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json; charset=utf-8'\n      },\n      body: JSON.stringify({\n        id: query.id,\n        price: price\n      })\n    });\n  }, {\n    revalidateOnFocus: false,\n    shouldRetryOnError: false,\n    onSuccess: function onSuccess() {\n      notification.success({\n        message: '报价成功'\n      });\n      setPrice(undefined);\n      setShouldSendRequest(false);\n      setSendConfirmVisible(false);\n      setShouldFetchMyOffer(true);\n      setShouldFetchMoreRecords(true);\n      setHasMoreRecords(true);\n      setRecordsPage(1);\n      mutateFetchMyOffer();\n      mutateFetchMoreRecords();\n      mutateFetchStatData();\n    },\n    onError: function onError() {\n      notification.error({\n        message: '报价发送失败，请重试'\n      });\n      setShouldSendRequest(false);\n    }\n  }),\n      _useSWR7$isValidating = _useSWR7.isValidating,\n      sendLoading = _useSWR7$isValidating === void 0 ? false : _useSWR7$isValidating; // 出售给Ta请求\n\n\n  var _useSWR8 = useSWR(shouldSellRequest ? '/api/sell' : null, function (url) {\n    return fetcher(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json; charset=utf-8'\n      },\n      body: JSON.stringify({\n        id: sellData === null || sellData === void 0 ? void 0 : sellData.id\n      })\n    });\n  }, {\n    revalidateOnFocus: false,\n    shouldRetryOnError: false,\n    onSuccess: function onSuccess() {\n      notification.success({\n        message: '操作成功'\n      });\n      setShouldSellRequest(false);\n      setSellConfirmVisible(false);\n      setShouldFetchMoreRecords(true);\n      setHasMoreRecords(true);\n      setRecordsPage(1);\n      mutateFetchMoreRecords();\n    },\n    onError: function onError() {\n      notification.error({\n        message: '操作失败，请重试'\n      });\n      setShouldSellRequest(false);\n    }\n  }),\n      _useSWR8$isValidating = _useSWR8.isValidating,\n      sellLoading = _useSWR8$isValidating === void 0 ? false : _useSWR8$isValidating; // 获取付款链接请求\n\n\n  var _useSWR9 = useSWR(shouldPaymentRequest ? '/api/payment' : null, function (url) {\n    return fetcher(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json; charset=utf-8'\n      },\n      body: JSON.stringify({\n        orderId: hasWon === null || hasWon === void 0 ? void 0 : hasWon.orderId,\n        returnUrl: location.href\n      })\n    });\n  }, {\n    revalidateOnFocus: false,\n    shouldRetryOnError: false,\n    onSuccess: function onSuccess(data) {\n      setShouldPaymentRequest(false);\n      var a = document.createElement('a');\n      a.target = '_blank';\n      a.href = data.paymentUrl;\n      a.click();\n    },\n    onError: function onError() {\n      notification.error({\n        message: '获取付款链接失败，请重试'\n      });\n      setShouldPaymentRequest(false);\n    }\n  }),\n      _useSWR9$isValidating = _useSWR9.isValidating,\n      paymentLoading = _useSWR9$isValidating === void 0 ? false : _useSWR9$isValidating;\n\n  var columns = [{\n    title: '类型',\n    key: 'type',\n    dataIndex: 'type',\n    render: function render(value) {\n      return RecordItemTypeMap[value];\n    }\n  }, {\n    title: '时间',\n    key: 'time',\n    dataIndex: 'time',\n    render: function render(value) {\n      return moment(value).format('YYYY/MM/DD HH:mm');\n    }\n  }, {\n    title: '用户昵称',\n    key: 'user.name',\n    dataIndex: ['user', 'name']\n  }, {\n    title: '金额',\n    key: 'price',\n    dataIndex: 'price',\n    render: function render(value) {\n      return formatMoney(value, '¥ ');\n    }\n  }, {\n    render: function render(_, item) {\n      return /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [(me === null || me === void 0 ? void 0 : me.isLoggedIn) && !canPurchased && item.type === 0 && !item.expire && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles['table-action'],\n          children: /*#__PURE__*/_jsxDEV(Space, {\n            children: [!sellingValidating && selling && selling.length === 0 && /*#__PURE__*/_jsxDEV(Button, {\n              type: \"primary\",\n              size: \"small\",\n              shape: \"round\",\n              onClick: function onClick() {\n                setSellData({\n                  id: item.id,\n                  price: item.price,\n                  name: item.user.name\n                });\n                setSellConfirmVisible(true);\n              },\n              children: \"\\u51FA\\u552E\\u7ED9Ta\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 19\n            }, _this), !sellingValidating && selling && selling.includes(item.user.id) && /*#__PURE__*/_jsxDEV(Tag, {\n              color: \"#1858f9\",\n              children: \"\\u7B49\\u5F85\\u4ED8\\u6B3E\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 308,\n              columnNumber: 21\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 13\n        }, _this), (me === null || me === void 0 ? void 0 : me.isLoggedIn) && item.expire && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles['table-action'],\n          children: /*#__PURE__*/_jsxDEV(Space, {\n            children: /*#__PURE__*/_jsxDEV(Tag, {\n              color: \"#000\",\n              style: {\n                opacity: 0.3\n              },\n              children: \"\\u5DF2\\u8FC7\\u671F\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 316,\n              columnNumber: 17\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 315,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 314,\n          columnNumber: 13\n        }, _this)]\n      }, void 0, true);\n    }\n  }]; // 报价\n\n  var onSend = function onSend() {\n    if (!price || price < 10 || String(price / 10).indexOf('.') !== -1) {\n      notification.error({\n        message: '报价金额必须是10的整数倍'\n      });\n      return;\n    }\n\n    setSendConfirmVisible(true);\n  }; // 确认报价\n\n\n  var onSendOk = function onSendOk() {\n    return setShouldSendRequest(true);\n  }; // 加载更多交易记录\n\n\n  var onLoadMore = function onLoadMore() {\n    setRecordsPage(recordsPage + 1);\n    setShouldFetchMoreRecords(true);\n  }; // 刷新交易记录\n\n\n  var onReloadRecords = function onReloadRecords() {\n    setShouldFetchMoreRecords(true);\n    setHasMoreRecords(true);\n    setRecordsPage(1);\n    mutateFetchMoreRecords();\n  }; // 确定出售给Ta\n\n\n  var onSellOk = function onSellOk() {\n    return setShouldSellRequest(true);\n  }; // 去支付\n\n\n  var onPayment = function onPayment() {\n    return setShouldPaymentRequest(true);\n  };\n\n  return /*#__PURE__*/_jsxDEV(Layout, {\n    children: [/*#__PURE__*/_jsxDEV(ShareModal, {\n      visible: shareVisible,\n      cardData: cardData,\n      price: hasBeenSold ? _final ? _final === null || _final === void 0 ? void 0 : _final.price : undefined : records.length !== 0 ? records[0].price : undefined,\n      time: hasBeenSold ? _final ? _final === null || _final === void 0 ? void 0 : _final.time : undefined : records.length !== 0 ? records[0].time : undefined,\n      onClose: function onClose() {\n        return setShareVisible(false);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(SellModal, {\n      price: sellData === null || sellData === void 0 ? void 0 : sellData.price,\n      name: sellData === null || sellData === void 0 ? void 0 : sellData.name,\n      visible: sellConfirmVisible,\n      loading: sellLoading,\n      onOk: onSellOk,\n      onCancel: function onCancel() {\n        return setSellConfirmVisible(false);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 386,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(QuotedPriceModal, {\n      price: price,\n      visible: sendConfirmVisible,\n      loading: sendLoading,\n      onOk: onSendOk,\n      onCancel: function onCancel() {\n        return setSendConfirmVisible(false);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(Row, {\n        gutter: {\n          xs: 0,\n          sm: 6\n        },\n        className: styles.showcase,\n        children: [/*#__PURE__*/_jsxDEV(Col, {\n          xs: 24,\n          sm: 9,\n          children: /*#__PURE__*/_jsxDEV(Card, {\n            arrows: true,\n            type: \"simple\",\n            photoPreview: false,\n            data: cardData\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 404,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 403,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          xs: 24,\n          sm: 1,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: styles.tools,\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              className: styles.btn,\n              onClick: function onClick() {\n                return setShareVisible(true);\n              },\n              icon: /*#__PURE__*/_jsxDEV(ShareAltOutlined, {\n                size: 18\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 411,\n                columnNumber: 23\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 408,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 407,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 406,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          xs: 24,\n          sm: 14,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: styles.main,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: styles.users,\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.u,\n                children: [\"Creator:\", /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: cardData !== null && cardData !== void 0 && cardData.creator ? cardData.creator.name : '-'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 420,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 418,\n                columnNumber: 17\n              }, this), (cardData === null || cardData === void 0 ? void 0 : cardData.holder) && cardData.creator.id !== cardData.holder.id && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.u,\n                children: [\"Holder:\", /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: cardData.holder.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 426,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 424,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 417,\n              columnNumber: 15\n            }, this), (me === null || me === void 0 ? void 0 : me.isLoggedIn) && !canPurchased && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: styles['price-info'],\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.title,\n                children: \"\\u6700\\u9AD8\\u62A5\\u4EF7\\uFF1A\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 448,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.high,\n                children: [fetchStatDataValidating && !statData && /*#__PURE__*/_jsxDEV(Spin, {\n                  indicator: /*#__PURE__*/_jsxDEV(LoadingOutlined, {\n                    className: styles.spin\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 452,\n                    columnNumber: 36\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 451,\n                  columnNumber: 23\n                }, this), statData && /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: formatMoney(statData.highPrice, '¥ ')\n                }, void 0, false)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 449,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 447,\n              columnNumber: 17\n            }, this), (me === null || me === void 0 ? void 0 : me.isLoggedIn) && canPurchased && /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [hasWonValidating && /*#__PURE__*/_jsxDEV(Spin, {\n                className: styles['main-loader'],\n                indicator: /*#__PURE__*/_jsxDEV(LoadingOutlined, {\n                  className: styles.spin\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 464,\n                  columnNumber: 34\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 462,\n                columnNumber: 21\n              }, this), !hasWonValidating && (hasWon === null || hasWon === void 0 ? void 0 : hasWon.result) && hasWon.price && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.win,\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.title,\n                  children: [\"\\u4F60\\u5DF2\\u4E2D\\u6807\\uFF01\\u4E2D\\u6807\\u4EF7\\u683C\\uFF1A \", formatMoney(hasWon.price, '¥ ')]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 469,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.help,\n                  children: [\"\\u8BF7\\u5728\", /*#__PURE__*/_jsxDEV(Countdown, {\n                    valueStyle: {\n                      fontSize: 14,\n                      fontWeight: 'bold',\n                      marginLeft: 5,\n                      marginRight: 5,\n                      color: '#1858f9'\n                    },\n                    value: hasWon.expire,\n                    format: \"H \\u5C0F\\u65F6 m \\u5206 s \\u79D2\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 474,\n                    columnNumber: 25\n                  }, this), \"\\u5185\\u4ED8\\u6B3E\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 472,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.help,\n                  children: \"\\u8BF7\\u572824\\u5C0F\\u65F6\\u5185\\u5B8C\\u6210\\u652F\\u4ED8\\uFF0C24\\u5C0F\\u65F6\\u5185\\u672A\\u652F\\u4ED8\\u5C06\\u6263\\u966420\\u5206\\u4FE1\\u8A89\\u5206\\uFF0C \\u4FE1\\u8A89\\u5206\\u4F4E\\u4E8E60\\u5206\\u5C06\\u65E0\\u6CD5\\u51FA\\u4EF7\\u3002\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 487,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.btns,\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.column,\n                    children: /*#__PURE__*/_jsxDEV(Button, {\n                      block: true,\n                      className: styles.pay,\n                      type: \"primary\",\n                      size: \"large\",\n                      onClick: onPayment,\n                      loading: paymentLoading,\n                      children: \"\\u53BB\\u652F\\u4ED8\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 493,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 492,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 491,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 468,\n                columnNumber: 21\n              }, this), !hasWonValidating && !(hasWon !== null && hasWon !== void 0 && hasWon.result) && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"\".concat(styles['send-price'], \" send-price\"),\n                children: [!fetchMyOfferValidating && myOffer && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.prompt,\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    children: [\"\\u5F53\\u524D\\u62A5\\u4EF7\\u4E3A\\uFF1A\", formatMoney(myOffer.price, '¥ '), \"\\uFF0C\\u6709\\u6548\\u671F\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 511,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(Countdown, {\n                    valueStyle: {\n                      fontSize: 14,\n                      marginLeft: 5\n                    },\n                    value: myOffer.expire,\n                    format: \"H \\u5C0F\\u65F6 m \\u5206 s \\u79D2\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 515,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 510,\n                  columnNumber: 25\n                }, this), !fetchMyOfferValidating && !myOffer && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.prompt,\n                  children: \"\\u5F53\\u524D\\u6682\\u65E0\\u62A5\\u4EF7\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 523,\n                  columnNumber: 25\n                }, this), fetchMyOfferValidating && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.prompt,\n                  children: \"\\u83B7\\u53D6\\u4F60\\u7684\\u62A5\\u4EF7\\u4E2D...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 526,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.input,\n                  children: [/*#__PURE__*/_jsxDEV(Row, {\n                    gutter: 18,\n                    children: [/*#__PURE__*/_jsxDEV(Col, {\n                      xs: 16,\n                      flex: !isMobile ? 'auto' : undefined,\n                      children: /*#__PURE__*/_jsxDEV(PriceInput, {\n                        value: price,\n                        onChange: function onChange(value) {\n                          return setPrice(value);\n                        },\n                        size: \"large\",\n                        precision: 0,\n                        disabled: sendConfirmVisible\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 531,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 530,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(Col, {\n                      xs: 8,\n                      flex: !isMobile ? '150px' : undefined,\n                      children: /*#__PURE__*/_jsxDEV(Button, {\n                        block: true,\n                        className: \"btn\",\n                        type: \"primary\",\n                        size: \"large\",\n                        loading: sendConfirmVisible,\n                        onClick: onSend,\n                        children: \"\\u62A5\\u4EF7\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 540,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 539,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 529,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.help,\n                    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                      children: \"\\u62A5\\u4EF7\\u91D1\\u989D\\u5FC5\\u987B\\u662F10\\u7684\\u6574\\u6570\\u500D\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 553,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      children: \"\\u5982\\u62A5\\u4EF7\\u540E\\u4E2D\\u6807\\uFF0C\\u987B\\u572824\\u5C0F\\u65F6\\u5185\\u652F\\u4ED8\\uFF0C\\u903E\\u671F\\u672A\\u4ED8\\u5C06\\u6263\\u966420\\u4FE1\\u8A89\\u503C\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 554,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 552,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 528,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 508,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true), !(me !== null && me !== void 0 && me.isLoggedIn) && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: styles.btns,\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.column,\n                children: /*#__PURE__*/_jsxDEV(Button, {\n                  block: true,\n                  type: \"primary\",\n                  size: \"large\",\n                  onClick: function onClick() {\n                    return router.push({\n                      pathname: '/login',\n                      query: {\n                        ref: encodeURIComponent(router.asPath)\n                      }\n                    });\n                  },\n                  children: \"\\u6211 \\u8981 \\u4E70\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 566,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 565,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 564,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: styles.statistics,\n              children: /*#__PURE__*/_jsxDEV(Row, {\n                gutter: 4,\n                children: [/*#__PURE__*/_jsxDEV(Col, {\n                  xs: 6,\n                  span: 8,\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.title,\n                    children: \"\\u62A5\\u4EF7\\u5355\\u6570\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 585,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"\".concat(styles.count, \" \").concat(styles.first),\n                    children: [fetchStatDataValidating && !statData && /*#__PURE__*/_jsxDEV(Spin, {\n                      size: \"small\",\n                      indicator: /*#__PURE__*/_jsxDEV(LoadingOutlined, {\n                        className: styles.spin\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 591,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 588,\n                      columnNumber: 25\n                    }, this), statData && /*#__PURE__*/_jsxDEV(_Fragment, {\n                      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                        children: statData.offerTotal\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 597,\n                        columnNumber: 27\n                      }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n                        children: \"\\u5355\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 598,\n                        columnNumber: 27\n                      }, this)]\n                    }, void 0, true)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 586,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 584,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  xs: 9,\n                  span: 8,\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.title,\n                    children: \"\\u62A5\\u4EF7\\u6700\\u9AD8\\u91D1\\u989D\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 604,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.count,\n                    children: [fetchStatDataValidating && !statData && /*#__PURE__*/_jsxDEV(Spin, {\n                      size: \"small\",\n                      indicator: /*#__PURE__*/_jsxDEV(LoadingOutlined, {\n                        className: styles.spin\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 610,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 607,\n                      columnNumber: 25\n                    }, this), statData && /*#__PURE__*/_jsxDEV(\"span\", {\n                      children: formatMoney(statData.highPrice, '¥ ')\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 615,\n                      columnNumber: 25\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 605,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 603,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  xs: 9,\n                  span: 8,\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.title,\n                    children: \"\\u62A5\\u4EF7\\u5E73\\u5747\\u91D1\\u989D\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 620,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"\".concat(styles.count, \" \").concat(styles.last),\n                    children: [fetchStatDataValidating && !statData && /*#__PURE__*/_jsxDEV(Spin, {\n                      size: \"small\",\n                      indicator: /*#__PURE__*/_jsxDEV(LoadingOutlined, {\n                        className: styles.spin\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 626,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 623,\n                      columnNumber: 25\n                    }, this), statData && /*#__PURE__*/_jsxDEV(\"span\", {\n                      children: formatMoney(statData.averagePrice, '¥ ')\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 631,\n                      columnNumber: 25\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 621,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 619,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 583,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 582,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 415,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.table,\n        children: [/*#__PURE__*/_jsxDEV(Table, {\n          title: function title() {\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: styles.header,\n              children: [\"\\u4EA4\\u6613\\u8BB0\\u5F55\", /*#__PURE__*/_jsxDEV(Tooltip, {\n                title: \"\\u5237\\u65B0\",\n                children: /*#__PURE__*/_jsxDEV(\"a\", {\n                  onClick: onReloadRecords,\n                  children: /*#__PURE__*/_jsxDEV(ReloadOutlined, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 647,\n                    columnNumber: 21\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 646,\n                  columnNumber: 19\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 645,\n                columnNumber: 17\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 643,\n              columnNumber: 15\n            }, _this);\n          },\n          columns: columns,\n          pagination: false,\n          rowKey: \"id\",\n          dataSource: records,\n          scroll: isMobile ? {\n            x: 700\n          } : {}\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 641,\n          columnNumber: 11\n        }, this), hasMoreRecords && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.loadmore,\n          children: [!fetchMoreRecordsValidating && /*#__PURE__*/_jsxDEV(DoubleRightOutlined, {\n            className: styles.icon,\n            onClick: onLoadMore\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 661,\n            columnNumber: 17\n          }, this), fetchMoreRecordsValidating && /*#__PURE__*/_jsxDEV(Spin, {\n            indicator: /*#__PURE__*/_jsxDEV(LoadingOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 667,\n              columnNumber: 34\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 667,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 659,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 640,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 362,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Detail, \"UNqPW+NAZ8AND5NihP9iuZY5G0I=\", false, function () {\n  return [useRouter, useMe, useIsMobile, useSWR, useSWR, useSWR, useSWR, useSWR, useSWR, useSWR, useSWR, useSWR];\n});\n\n_c = Detail;\n\nvar _c;\n\n$RefreshReg$(_c, \"Detail\");","map":{"version":3,"sources":["/Users/joker/Desktop/ink/work/nft-holder/pages/detail/[id].tsx"],"names":["useRouter","useEffect","useState","Row","Col","Button","Table","notification","Space","Statistic","Spin","Tooltip","Tag","ShareAltOutlined","DoubleRightOutlined","LoadingOutlined","ReloadOutlined","formatMoney","moment","useSWR","Layout","Card","PriceInput","QuotedPriceModal","SellModal","ShareModal","useMe","useIsMobile","fetcher","RecordItemTypeMap","styles","Countdown","Detail","cardData","cardStatus","router","query","me","isMobile","records","setRecords","hasMoreRecords","setHasMoreRecords","recordsPage","setRecordsPage","price","setPrice","myOffer","setMyOffer","sellData","setSellData","sendConfirmVisible","setSendConfirmVisible","sellConfirmVisible","setSellConfirmVisible","shareVisible","setShareVisible","shouldSendRequest","setShouldSendRequest","shouldSellRequest","setShouldSellRequest","shouldFetchMyOffer","setShouldFetchMyOffer","shouldFetchMoreRecords","setShouldFetchMoreRecords","shouldPaymentRequest","setShouldPaymentRequest","isCreator","isLoggedIn","id","creator","isHolder","holder","hasBeenSold","canPurchased","revalidateOnFocus","onSuccess","data","length","concat","isValidating","fetchMoreRecordsValidating","mutateFetchMoreRecords","mutate","hasWon","hasWonValidating","selling","sellingValidating","final","expire","fetchMyOfferValidating","mutateFetchMyOffer","statData","fetchStatDataValidating","mutateFetchStatData","url","method","headers","body","JSON","stringify","shouldRetryOnError","success","message","undefined","onError","error","sendLoading","sellLoading","orderId","returnUrl","location","href","a","document","createElement","target","paymentUrl","click","paymentLoading","columns","title","key","dataIndex","render","value","format","_","item","type","name","user","includes","opacity","onSend","String","indexOf","onSendOk","onLoadMore","onReloadRecords","onSellOk","onPayment","time","xs","sm","showcase","tools","btn","main","users","u","high","spin","highPrice","result","win","help","fontSize","fontWeight","marginLeft","marginRight","color","btns","column","pay","prompt","input","push","pathname","ref","encodeURIComponent","asPath","statistics","count","first","offerTotal","last","averagePrice","table","header","x","loadmore","icon"],"mappings":";;;;;;AACA,SAASA,SAAT,QAA0B,aAA1B;AACA,SAASC,SAAT,EAAoBC,QAApB,QAAoC,OAApC;AACA,SACEC,GADF,EAEEC,GAFF,EAGEC,MAHF,EAIEC,KAJF,EAMEC,YANF,EAOEC,KAPF,EAQEC,SARF,EASEC,IATF,EAUEC,OAVF,EAWEC,GAXF,QAYO,MAZP;AAaA,SACEC,gBADF,EAEEC,mBAFF,EAGEC,eAHF,EAIEC,cAJF,QAKO,mBALP;AAMA,SAASC,WAAT,QAA4B,YAA5B;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,MAAP,MAAmB,KAAnB;AAEA,OAAOC,MAAP,MAAmB,yBAAnB;AACA,OAAOC,IAAP,MAAiB,uBAAjB;AACA,OAAOC,UAAP,MAAuB,8BAAvB;AACA,OAAOC,gBAAP,MAA6B,qCAA7B;AACA,OAAOC,SAAP,MAAsB,6BAAtB;AACA,OAAOC,UAAP,MAAuB,8BAAvB;AACA,OAAOC,KAAP,MAAkB,oBAAlB;AACA,OAAOC,WAAP,MAAwB,2BAAxB;AAGA,OAAOC,OAAP,MAAoB,mBAApB;AAEA,SAEEC,iBAFF,QAOO,sBAPP;AASA,OAAOC,MAAP,MAAmB,gCAAnB;IAEQC,S,GAActB,S,CAAdsB,S;;AAOR,eAAe,SAASC,MAAT,OAAuD;AAAA;;AAAA;AAAA;AAAA;;AAAA,MAArCC,QAAqC,QAArCA,QAAqC;AAAA,MAA3BC,UAA2B,QAA3BA,UAA2B;AACpE,MAAMC,MAAM,GAAGnC,SAAS,EAAxB;AADoE,MAE5DoC,KAF4D,GAElDD,MAFkD,CAE5DC,KAF4D;;AAAA,eAGrDV,KAAK,EAHgD;AAAA,MAG5DW,EAH4D,UAG5DA,EAH4D;;AAIpE,MAAMC,QAAQ,GAAGX,WAAW,EAA5B;;AAJoE,kBAKtCzB,QAAQ,CAAuB,EAAvB,CAL8B;AAAA,MAK7DqC,OAL6D;AAAA,MAKpDC,UALoD;;AAAA,mBAMxBtC,QAAQ,CAAU,IAAV,CANgB;AAAA,MAM7DuC,cAN6D;AAAA,MAM7CC,iBAN6C;;AAAA,mBAO9BxC,QAAQ,CAAS,CAAT,CAPsB;AAAA,MAO7DyC,WAP6D;AAAA,MAOhDC,cAPgD;;AAAA,mBAQ1C1C,QAAQ,EARkC;AAAA,MAQ7D2C,KAR6D;AAAA,MAQtDC,QARsD;;AAAA,mBAStC5C,QAAQ,EAT8B;AAAA,MAS7D6C,OAT6D;AAAA,MASpDC,UAToD;;AAAA,mBAUpC9C,QAAQ,EAV4B;AAAA,MAU7D+C,QAV6D;AAAA,MAUnDC,WAVmD;;AAAA,mBAWhBhD,QAAQ,CAAU,KAAV,CAXQ;AAAA,MAW7DiD,kBAX6D;AAAA,MAWzCC,qBAXyC;;AAAA,mBAYhBlD,QAAQ,CAAU,KAAV,CAZQ;AAAA,MAY7DmD,kBAZ6D;AAAA,MAYzCC,qBAZyC;;AAAA,mBAa5BpD,QAAQ,CAAU,KAAV,CAboB;AAAA,MAa7DqD,YAb6D;AAAA,MAa/CC,eAb+C;;AAAA,oBAclBtD,QAAQ,CAAU,KAAV,CAdU;AAAA,MAc7DuD,iBAd6D;AAAA,MAc1CC,oBAd0C;;AAAA,oBAelBxD,QAAQ,CAAU,KAAV,CAfU;AAAA,MAe7DyD,iBAf6D;AAAA,MAe1CC,oBAf0C;;AAAA,oBAgBhB1D,QAAQ,CAAU,KAAV,CAhBQ;AAAA,MAgB7D2D,kBAhB6D;AAAA,MAgBzCC,qBAhByC;;AAAA,oBAiBR5D,QAAQ,CAClE,IADkE,CAjBA;AAAA,MAiB7D6D,sBAjB6D;AAAA,MAiBrCC,yBAjBqC;;AAAA,oBAoBZ9D,QAAQ,CAC9D,KAD8D,CApBI;AAAA,MAoB7D+D,oBApB6D;AAAA,MAoBvCC,uBApBuC,mBAwBpE;;;AACA,MAAMC,SAAS,GAAG,CAAA9B,EAAE,SAAF,IAAAA,EAAE,WAAF,YAAAA,EAAE,CAAE+B,UAAJ,KAAkB/B,EAAE,CAACgC,EAAH,MAAUpC,QAAV,aAAUA,QAAV,4CAAUA,QAAQ,CAAEqC,OAApB,sDAAU,kBAAmBD,EAA7B,CAApC,CAzBoE,CA0BpE;;AACA,MAAME,QAAQ,GAAG,CAAAlC,EAAE,SAAF,IAAAA,EAAE,WAAF,YAAAA,EAAE,CAAE+B,UAAJ,KAAkB/B,EAAE,CAACgC,EAAH,MAAUpC,QAAV,aAAUA,QAAV,2CAAUA,QAAQ,CAAEuC,MAApB,qDAAU,iBAAkBH,EAA5B,CAAnC,CA3BoE,CA4BpE;;AACA,MAAMI,WAAW,GAAGvC,UAAU,KAAK,CAAnC,CA7BoE,CA8BpE;;AACA,MAAMwC,YAAY,GAAGrC,EAAE,SAAF,IAAAA,EAAE,WAAF,IAAAA,EAAE,CAAE+B,UAAJ,IAAkBK,WAAlB,GAAgC,CAACF,QAAjC,GAA4C,CAACJ,SAAlE;AAEAlE,EAAAA,SAAS,CAAC,YAAM;AACd,QAAIoC,EAAE,SAAF,IAAAA,EAAE,WAAF,IAAAA,EAAE,CAAE+B,UAAJ,IAAkB,CAACK,WAAvB,EAAoC;AAClCX,MAAAA,qBAAqB,CAAC,IAAD,CAArB;AACD;AACF,GAJQ,EAIN,CAACW,WAAD,EAAcpC,EAAd,aAAcA,EAAd,uBAAcA,EAAE,CAAE+B,UAAlB,CAJM,CAAT,CAjCoE,CAuCpE;;AAvCoE,gBA2ChEjD,MAAM,CACR4C,sBAAsB,IAAItB,cAA1B,6BACuBL,KAAK,CAACiC,EAD7B,kCACuD1B,WADvD,IAEI,IAHI,EAIR;AACEgC,IAAAA,iBAAiB,EAAE,KADrB;AAEEC,IAAAA,SAAS,EAAE,mBAACC,IAAD,EAAU;AACnBb,MAAAA,yBAAyB,CAAC,KAAD,CAAzB;;AACA,UAAI,CAACa,IAAI,CAACC,MAAV,EAAkB;AAChBpC,QAAAA,iBAAiB,CAAC,KAAD,CAAjB;AACA;AACD;;AACDF,MAAAA,UAAU,CAACG,WAAW,KAAK,CAAhB,GAAoBkC,IAApB,GAA2BtC,OAAO,CAACwC,MAAR,CAAeF,IAAf,CAA5B,CAAV;AACD;AATH,GAJQ,CA3C0D;AAAA,qCAyClEG,YAzCkE;AAAA,MAyCpDC,0BAzCoD,qCAyCvB,IAzCuB;AAAA,MA0C1DC,sBA1C0D,WA0ClEC,MA1CkE,EA4DpE;;;AA5DoE,iBAgEhEhE,MAAM,CACRkB,EAAE,SAAF,IAAAA,EAAE,WAAF,IAAAA,EAAE,CAAE+B,UAAJ,IAAkBM,YAAlB,4BAAmDtC,KAAK,CAACiC,EAAzD,IAAgE,IADxD,EAER;AAAEM,IAAAA,iBAAiB,EAAE;AAArB,GAFQ,CAhE0D;AAAA,MA8D5DS,MA9D4D,YA8DlEP,IA9DkE;AAAA,MA+DpDQ,gBA/DoD,YA+DlEL,YA/DkE,EAqEpE;;;AArEoE,iBAsEF7D,MAAM,CAGtE,CAACuD,YAAD,IAAiB,CAACO,0BAAlB,6BACuB7C,KAAK,CAACiC,EAD7B,IAEI,IALkE,EAMtE;AACEM,IAAAA,iBAAiB,EAAE;AADrB,GANsE,CAtEJ;AAAA,MAsEtDW,OAtEsD,YAsE5DT,IAtE4D;AAAA,uCAsE7CG,YAtE6C;AAAA,MAsE/BO,iBAtE+B,sCAsEX,IAtEW,0BAiFpE;;;AAjFoE,iBAkF5CpE,MAAM,CAC5BkB,EAAE,SAAF,IAAAA,EAAE,WAAF,IAAAA,EAAE,CAAE+B,UAAJ,IAAkBK,WAAlB,2BAAiDrC,KAAK,CAACiC,EAAvD,IAA8D,IADlC,EAE5B;AACEM,IAAAA,iBAAiB,EAAE;AADrB,GAF4B,CAlFsC;AAAA,MAkFtDa,MAlFsD,YAkF5DX,IAlF4D,EAyFpE;;;AAzFoE,iBA6FhE1D,MAAM,CACR0C,kBAAkB,8BAAuBzB,KAAK,CAACiC,EAA7B,IAAoC,IAD9C,EAER;AACEO,IAAAA,SAAS,EAAE,mBAACC,IAAD,EAAU;AACnB,UAAIA,IAAI,CAAChC,KAAL,IAAcgC,IAAI,CAACY,MAAvB,EAA+BzC,UAAU,CAAC6B,IAAD,CAAV;AAC/Bf,MAAAA,qBAAqB,CAAC,KAAD,CAArB;AACD;AAJH,GAFQ,CA7F0D;AAAA,uCA2FlEkB,YA3FkE;AAAA,MA2FpDU,sBA3FoD,sCA2F3B,IA3F2B;AAAA,MA4F1DC,kBA5F0D,YA4FlER,MA5FkE,EAuGpE;;;AAvGoE,iBA4GhEhE,MAAM,6BAAoCiB,KAAK,CAACiC,EAA1C,GAAgD;AACxDM,IAAAA,iBAAiB,EAAE;AADqC,GAAhD,CA5G0D;AAAA,MAyG5DiB,QAzG4D,YAyGlEf,IAzGkE;AAAA,uCA0GlEG,YA1GkE;AAAA,MA0GpDa,uBA1GoD,sCA0G1B,IA1G0B;AAAA,MA2G1DC,mBA3G0D,YA2GlEX,MA3GkE,EAgHpE;;;AAhHoE,iBAiHtBhE,MAAM,CAClDsC,iBAAiB,GAAG,YAAH,GAAkB,IADe,EAElD,UAACsC,GAAD;AAAA,WACEnE,OAAO,CAACmE,GAAD,EAAM;AACXC,MAAAA,MAAM,EAAE,MADG;AAEXC,MAAAA,OAAO,EAAE;AAAE,wBAAgB;AAAlB,OAFE;AAGXC,MAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AAAE/B,QAAAA,EAAE,EAAEjC,KAAK,CAACiC,EAAZ;AAAgBxB,QAAAA,KAAK,EAALA;AAAhB,OAAf;AAHK,KAAN,CADT;AAAA,GAFkD,EAQlD;AACE8B,IAAAA,iBAAiB,EAAE,KADrB;AAEE0B,IAAAA,kBAAkB,EAAE,KAFtB;AAGEzB,IAAAA,SAAS,EAAE,qBAAM;AACfrE,MAAAA,YAAY,CAAC+F,OAAb,CAAqB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAArB;AACAzD,MAAAA,QAAQ,CAAC0D,SAAD,CAAR;AACA9C,MAAAA,oBAAoB,CAAC,KAAD,CAApB;AACAN,MAAAA,qBAAqB,CAAC,KAAD,CAArB;AACAU,MAAAA,qBAAqB,CAAC,IAAD,CAArB;AACAE,MAAAA,yBAAyB,CAAC,IAAD,CAAzB;AACAtB,MAAAA,iBAAiB,CAAC,IAAD,CAAjB;AACAE,MAAAA,cAAc,CAAC,CAAD,CAAd;AACA+C,MAAAA,kBAAkB;AAClBT,MAAAA,sBAAsB;AACtBY,MAAAA,mBAAmB;AACpB,KAfH;AAgBEW,IAAAA,OAAO,EAAE,mBAAM;AACblG,MAAAA,YAAY,CAACmG,KAAb,CAAmB;AAAEH,QAAAA,OAAO,EAAE;AAAX,OAAnB;AACA7C,MAAAA,oBAAoB,CAAC,KAAD,CAApB;AACD;AAnBH,GARkD,CAjHgB;AAAA,uCAiH5DsB,YAjH4D;AAAA,MAiH9C2B,WAjH8C,sCAiHhC,KAjHgC,0BAgJpE;;;AAhJoE,iBAiJtBxF,MAAM,CAClDwC,iBAAiB,GAAG,WAAH,GAAiB,IADgB,EAElD,UAACoC,GAAD;AAAA,WACEnE,OAAO,CAACmE,GAAD,EAAM;AACXC,MAAAA,MAAM,EAAE,MADG;AAEXC,MAAAA,OAAO,EAAE;AAAE,wBAAgB;AAAlB,OAFE;AAGXC,MAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AAAE/B,QAAAA,EAAE,EAAEpB,QAAF,aAAEA,QAAF,uBAAEA,QAAQ,CAAEoB;AAAhB,OAAf;AAHK,KAAN,CADT;AAAA,GAFkD,EAQlD;AACEM,IAAAA,iBAAiB,EAAE,KADrB;AAEE0B,IAAAA,kBAAkB,EAAE,KAFtB;AAGEzB,IAAAA,SAAS,EAAE,qBAAM;AACfrE,MAAAA,YAAY,CAAC+F,OAAb,CAAqB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAArB;AACA3C,MAAAA,oBAAoB,CAAC,KAAD,CAApB;AACAN,MAAAA,qBAAqB,CAAC,KAAD,CAArB;AACAU,MAAAA,yBAAyB,CAAC,IAAD,CAAzB;AACAtB,MAAAA,iBAAiB,CAAC,IAAD,CAAjB;AACAE,MAAAA,cAAc,CAAC,CAAD,CAAd;AACAsC,MAAAA,sBAAsB;AACvB,KAXH;AAYEuB,IAAAA,OAAO,EAAE,mBAAM;AACblG,MAAAA,YAAY,CAACmG,KAAb,CAAmB;AAAEH,QAAAA,OAAO,EAAE;AAAX,OAAnB;AACA3C,MAAAA,oBAAoB,CAAC,KAAD,CAApB;AACD;AAfH,GARkD,CAjJgB;AAAA,uCAiJ5DoB,YAjJ4D;AAAA,MAiJ9C4B,WAjJ8C,sCAiJhC,KAjJgC,0BA4KpE;;;AA5KoE,iBA6KnBzF,MAAM,CACrD8C,oBAAoB,GAAG,cAAH,GAAoB,IADa,EAErD,UAAC8B,GAAD;AAAA,WACEnE,OAAO,CAACmE,GAAD,EAAM;AACXC,MAAAA,MAAM,EAAE,MADG;AAEXC,MAAAA,OAAO,EAAE;AAAE,wBAAgB;AAAlB,OAFE;AAGXC,MAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACnBS,QAAAA,OAAO,EAAEzB,MAAF,aAAEA,MAAF,uBAAEA,MAAM,CAAEyB,OADE;AAEnBC,QAAAA,SAAS,EAAEC,QAAQ,CAACC;AAFD,OAAf;AAHK,KAAN,CADT;AAAA,GAFqD,EAWrD;AACErC,IAAAA,iBAAiB,EAAE,KADrB;AAEE0B,IAAAA,kBAAkB,EAAE,KAFtB;AAGEzB,IAAAA,SAAS,EAAE,mBAACC,IAAD,EAAU;AACnBX,MAAAA,uBAAuB,CAAC,KAAD,CAAvB;AACA,UAAM+C,CAAC,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAV;AACAF,MAAAA,CAAC,CAACG,MAAF,GAAW,QAAX;AACAH,MAAAA,CAAC,CAACD,IAAF,GAASnC,IAAI,CAACwC,UAAd;AACAJ,MAAAA,CAAC,CAACK,KAAF;AACD,KATH;AAUEb,IAAAA,OAAO,EAAE,mBAAM;AACblG,MAAAA,YAAY,CAACmG,KAAb,CAAmB;AAAEH,QAAAA,OAAO,EAAE;AAAX,OAAnB;AACArC,MAAAA,uBAAuB,CAAC,KAAD,CAAvB;AACD;AAbH,GAXqD,CA7Ka;AAAA,uCA6K5Dc,YA7K4D;AAAA,MA6K9CuC,cA7K8C,sCA6K7B,KA7K6B;;AAyMpE,MAAMC,OAA+C,GAAG,CACtD;AACEC,IAAAA,KAAK,EAAE,IADT;AAEEC,IAAAA,GAAG,EAAE,MAFP;AAGEC,IAAAA,SAAS,EAAE,MAHb;AAIEC,IAAAA,MAAM,EAAE,gBAACC,KAAD;AAAA,aAAWhG,iBAAiB,CAACgG,KAAD,CAA5B;AAAA;AAJV,GADsD,EAOtD;AACEJ,IAAAA,KAAK,EAAE,IADT;AAEEC,IAAAA,GAAG,EAAE,MAFP;AAGEC,IAAAA,SAAS,EAAE,MAHb;AAIEC,IAAAA,MAAM,EAAE,gBAACC,KAAD;AAAA,aAAW3G,MAAM,CAAC2G,KAAD,CAAN,CAAcC,MAAd,CAAqB,kBAArB,CAAX;AAAA;AAJV,GAPsD,EAatD;AACEL,IAAAA,KAAK,EAAE,MADT;AAEEC,IAAAA,GAAG,EAAE,WAFP;AAGEC,IAAAA,SAAS,EAAE,CAAC,MAAD,EAAS,MAAT;AAHb,GAbsD,EAkBtD;AACEF,IAAAA,KAAK,EAAE,IADT;AAEEC,IAAAA,GAAG,EAAE,OAFP;AAGEC,IAAAA,SAAS,EAAE,OAHb;AAIEC,IAAAA,MAAM,EAAE,gBAACC,KAAD;AAAA,aAAW5G,WAAW,CAAC4G,KAAD,EAAQ,IAAR,CAAtB;AAAA;AAJV,GAlBsD,EAwBtD;AACED,IAAAA,MAAM,EAAE,gBAACG,CAAD,EAAIC,IAAJ;AAAA,0BACN;AAAA,mBACG,CAAA3F,EAAE,SAAF,IAAAA,EAAE,WAAF,YAAAA,EAAE,CAAE+B,UAAJ,KAAkB,CAACM,YAAnB,IAAmCsD,IAAI,CAACC,IAAL,KAAc,CAAjD,IAAsD,CAACD,IAAI,CAACvC,MAA5D,iBACC;AAAK,UAAA,SAAS,EAAE3D,MAAM,CAAC,cAAD,CAAtB;AAAA,iCACE,QAAC,KAAD;AAAA,uBACG,CAACyD,iBAAD,IAAsBD,OAAtB,IAAiCA,OAAO,CAACR,MAAR,KAAmB,CAApD,iBACC,QAAC,MAAD;AACE,cAAA,IAAI,EAAC,SADP;AAEE,cAAA,IAAI,EAAC,OAFP;AAGE,cAAA,KAAK,EAAC,OAHR;AAIE,cAAA,OAAO,EAAE,mBAAM;AACb5B,gBAAAA,WAAW,CAAC;AACVmB,kBAAAA,EAAE,EAAE2D,IAAI,CAAC3D,EADC;AAEVxB,kBAAAA,KAAK,EAAEmF,IAAI,CAACnF,KAFF;AAGVqF,kBAAAA,IAAI,EAAEF,IAAI,CAACG,IAAL,CAAUD;AAHN,iBAAD,CAAX;AAKA5E,gBAAAA,qBAAqB,CAAC,IAAD,CAArB;AACD,eAXH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAFJ,EAkBG,CAACiC,iBAAD,IACCD,OADD,IAECA,OAAO,CAAC8C,QAAR,CAAiBJ,IAAI,CAACG,IAAL,CAAU9D,EAA3B,CAFD,iBAGG,QAAC,GAAD;AAAK,cAAA,KAAK,EAAC,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBArBN;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,iBAFJ,EA6BG,CAAAhC,EAAE,SAAF,IAAAA,EAAE,WAAF,YAAAA,EAAE,CAAE+B,UAAJ,KAAkB4D,IAAI,CAACvC,MAAvB,iBACC;AAAK,UAAA,SAAS,EAAE3D,MAAM,CAAC,cAAD,CAAtB;AAAA,iCACE,QAAC,KAAD;AAAA,mCACE,QAAC,GAAD;AAAK,cAAA,KAAK,EAAC,MAAX;AAAkB,cAAA,KAAK,EAAE;AAAEuG,gBAAAA,OAAO,EAAE;AAAX,eAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,iBA9BJ;AAAA,sBADM;AAAA;AADV,GAxBsD,CAAxD,CAzMoE,CA8QpE;;AACA,MAAMC,MAAM,GAAG,SAATA,MAAS,GAAM;AACnB,QAAI,CAACzF,KAAD,IAAUA,KAAK,GAAG,EAAlB,IAAwB0F,MAAM,CAAC1F,KAAK,GAAG,EAAT,CAAN,CAAmB2F,OAAnB,CAA2B,GAA3B,MAAoC,CAAC,CAAjE,EAAoE;AAClEjI,MAAAA,YAAY,CAACmG,KAAb,CAAmB;AACjBH,QAAAA,OAAO,EAAE;AADQ,OAAnB;AAGA;AACD;;AACDnD,IAAAA,qBAAqB,CAAC,IAAD,CAArB;AACD,GARD,CA/QoE,CAyRpE;;;AACA,MAAMqF,QAAQ,GAAG,SAAXA,QAAW;AAAA,WAAM/E,oBAAoB,CAAC,IAAD,CAA1B;AAAA,GAAjB,CA1RoE,CA4RpE;;;AACA,MAAMgF,UAAU,GAAG,SAAbA,UAAa,GAAM;AACvB9F,IAAAA,cAAc,CAACD,WAAW,GAAG,CAAf,CAAd;AACAqB,IAAAA,yBAAyB,CAAC,IAAD,CAAzB;AACD,GAHD,CA7RoE,CAkSpE;;;AACA,MAAM2E,eAAe,GAAG,SAAlBA,eAAkB,GAAM;AAC5B3E,IAAAA,yBAAyB,CAAC,IAAD,CAAzB;AACAtB,IAAAA,iBAAiB,CAAC,IAAD,CAAjB;AACAE,IAAAA,cAAc,CAAC,CAAD,CAAd;AACAsC,IAAAA,sBAAsB;AACvB,GALD,CAnSoE,CA0SpE;;;AACA,MAAM0D,QAAQ,GAAG,SAAXA,QAAW;AAAA,WAAMhF,oBAAoB,CAAC,IAAD,CAA1B;AAAA,GAAjB,CA3SoE,CA6SpE;;;AACA,MAAMiF,SAAS,GAAG,SAAZA,SAAY;AAAA,WAAM3E,uBAAuB,CAAC,IAAD,CAA7B;AAAA,GAAlB;;AAEA,sBACE,QAAC,MAAD;AAAA,4BACE,QAAC,UAAD;AACE,MAAA,OAAO,EAAEX,YADX;AAEE,MAAA,QAAQ,EAAEtB,QAFZ;AAGE,MAAA,KAAK,EACHwC,WAAW,GACPe,MAAK,GACHA,MADG,aACHA,MADG,uBACHA,MAAK,CAAE3C,KADJ,GAEH2D,SAHK,GAIPjE,OAAO,CAACuC,MAAR,KAAmB,CAAnB,GACAvC,OAAO,CAAC,CAAD,CAAP,CAAWM,KADX,GAEA2D,SAVR;AAYE,MAAA,IAAI,EACF/B,WAAW,GACPe,MAAK,GACHA,MADG,aACHA,MADG,uBACHA,MAAK,CAAEsD,IADJ,GAEHtC,SAHK,GAIPjE,OAAO,CAACuC,MAAR,KAAmB,CAAnB,GACAvC,OAAO,CAAC,CAAD,CAAP,CAAWuG,IADX,GAEAtC,SAnBR;AAqBE,MAAA,OAAO,EAAE;AAAA,eAAMhD,eAAe,CAAC,KAAD,CAArB;AAAA;AArBX;AAAA;AAAA;AAAA;AAAA,YADF,eAwBE,QAAC,SAAD;AACE,MAAA,KAAK,EAAEP,QAAF,aAAEA,QAAF,uBAAEA,QAAQ,CAAEJ,KADnB;AAEE,MAAA,IAAI,EAAEI,QAAF,aAAEA,QAAF,uBAAEA,QAAQ,CAAEiF,IAFlB;AAGE,MAAA,OAAO,EAAE7E,kBAHX;AAIE,MAAA,OAAO,EAAEuD,WAJX;AAKE,MAAA,IAAI,EAAEgC,QALR;AAME,MAAA,QAAQ,EAAE;AAAA,eAAMtF,qBAAqB,CAAC,KAAD,CAA3B;AAAA;AANZ;AAAA;AAAA;AAAA;AAAA,YAxBF,eAgCE,QAAC,gBAAD;AACE,MAAA,KAAK,EAAET,KADT;AAEE,MAAA,OAAO,EAAEM,kBAFX;AAGE,MAAA,OAAO,EAAEwD,WAHX;AAIE,MAAA,IAAI,EAAE8B,QAJR;AAKE,MAAA,QAAQ,EAAE;AAAA,eAAMrF,qBAAqB,CAAC,KAAD,CAA3B;AAAA;AALZ;AAAA;AAAA;AAAA;AAAA,YAhCF,eAuCE;AAAK,MAAA,SAAS,EAAC,WAAf;AAAA,8BACE,QAAC,GAAD;AAAK,QAAA,MAAM,EAAE;AAAE2F,UAAAA,EAAE,EAAE,CAAN;AAASC,UAAAA,EAAE,EAAE;AAAb,SAAb;AAA+B,QAAA,SAAS,EAAElH,MAAM,CAACmH,QAAjD;AAAA,gCACE,QAAC,GAAD;AAAK,UAAA,EAAE,EAAE,EAAT;AAAa,UAAA,EAAE,EAAE,CAAjB;AAAA,iCACE,QAAC,IAAD;AAAM,YAAA,MAAM,MAAZ;AAAa,YAAA,IAAI,EAAC,QAAlB;AAA2B,YAAA,YAAY,EAAE,KAAzC;AAAgD,YAAA,IAAI,EAAEhH;AAAtD;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBADF,eAIE,QAAC,GAAD;AAAK,UAAA,EAAE,EAAE,EAAT;AAAa,UAAA,EAAE,EAAE,CAAjB;AAAA,iCACE;AAAK,YAAA,SAAS,EAAEH,MAAM,CAACoH,KAAvB;AAAA,mCACE,QAAC,MAAD;AACE,cAAA,SAAS,EAAEpH,MAAM,CAACqH,GADpB;AAEE,cAAA,OAAO,EAAE;AAAA,uBAAM3F,eAAe,CAAC,IAAD,CAArB;AAAA,eAFX;AAGE,cAAA,IAAI,eAAE,QAAC,gBAAD;AAAkB,gBAAA,IAAI,EAAE;AAAxB;AAAA;AAAA;AAAA;AAAA;AAHR;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBAJF,eAaE,QAAC,GAAD;AAAK,UAAA,EAAE,EAAE,EAAT;AAAa,UAAA,EAAE,EAAE,EAAjB;AAAA,iCACE;AAAK,YAAA,SAAS,EAAE1B,MAAM,CAACsH,IAAvB;AAAA,oCACE;AAAK,cAAA,SAAS,EAAEtH,MAAM,CAACuH,KAAvB;AAAA,sCACE;AAAK,gBAAA,SAAS,EAAEvH,MAAM,CAACwH,CAAvB;AAAA,oDAEE;AAAA,4BAAOrH,QAAQ,SAAR,IAAAA,QAAQ,WAAR,IAAAA,QAAQ,CAAEqC,OAAV,GAAoBrC,QAAQ,CAACqC,OAAT,CAAiB4D,IAArC,GAA4C;AAAnD;AAAA;AAAA;AAAA;AAAA,wBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,EAKG,CAAAjG,QAAQ,SAAR,IAAAA,QAAQ,WAAR,YAAAA,QAAQ,CAAEuC,MAAV,KACCvC,QAAQ,CAACqC,OAAT,CAAiBD,EAAjB,KAAwBpC,QAAQ,CAACuC,MAAT,CAAgBH,EADzC,iBAEG;AAAK,gBAAA,SAAS,EAAEvC,MAAM,CAACwH,CAAvB;AAAA,mDAEE;AAAA,4BAAOrH,QAAQ,CAACuC,MAAT,CAAgB0D;AAAvB;AAAA;AAAA;AAAA;AAAA,wBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,sBAPN;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,EA8BG,CAAA7F,EAAE,SAAF,IAAAA,EAAE,WAAF,YAAAA,EAAE,CAAE+B,UAAJ,KAAkB,CAACM,YAAnB,iBACC;AAAK,cAAA,SAAS,EAAE5C,MAAM,CAAC,YAAD,CAAtB;AAAA,sCACE;AAAK,gBAAA,SAAS,EAAEA,MAAM,CAAC2F,KAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE;AAAK,gBAAA,SAAS,EAAE3F,MAAM,CAACyH,IAAvB;AAAA,2BACG1D,uBAAuB,IAAI,CAACD,QAA5B,iBACC,QAAC,IAAD;AACE,kBAAA,SAAS,eAAE,QAAC,eAAD;AAAiB,oBAAA,SAAS,EAAE9D,MAAM,CAAC0H;AAAnC;AAAA;AAAA;AAAA;AAAA;AADb;AAAA;AAAA;AAAA;AAAA,wBAFJ,EAMG5D,QAAQ,iBAAI;AAAA,4BAAG3E,WAAW,CAAC2E,QAAQ,CAAC6D,SAAV,EAAqB,IAArB;AAAd,iCANf;AAAA;AAAA;AAAA;AAAA;AAAA,sBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,oBA/BJ,EA2CG,CAAApH,EAAE,SAAF,IAAAA,EAAE,WAAF,YAAAA,EAAE,CAAE+B,UAAJ,KAAkBM,YAAlB,iBACC;AAAA,yBACGW,gBAAgB,iBACf,QAAC,IAAD;AACE,gBAAA,SAAS,EAAEvD,MAAM,CAAC,aAAD,CADnB;AAEE,gBAAA,SAAS,eAAE,QAAC,eAAD;AAAiB,kBAAA,SAAS,EAAEA,MAAM,CAAC0H;AAAnC;AAAA;AAAA;AAAA;AAAA;AAFb;AAAA;AAAA;AAAA;AAAA,sBAFJ,EAOG,CAACnE,gBAAD,KAAqBD,MAArB,aAAqBA,MAArB,uBAAqBA,MAAM,CAAEsE,MAA7B,KAAuCtE,MAAM,CAACvC,KAA9C,iBACC;AAAK,gBAAA,SAAS,EAAEf,MAAM,CAAC6H,GAAvB;AAAA,wCACE;AAAK,kBAAA,SAAS,EAAE7H,MAAM,CAAC2F,KAAvB;AAAA,8FACcxG,WAAW,CAACmE,MAAM,CAACvC,KAAR,EAAe,IAAf,CADzB;AAAA;AAAA;AAAA;AAAA;AAAA,wBADF,eAIE;AAAK,kBAAA,SAAS,EAAEf,MAAM,CAAC8H,IAAvB;AAAA,0DAEE,QAAC,SAAD;AACE,oBAAA,UAAU,EAAE;AACVC,sBAAAA,QAAQ,EAAE,EADA;AAEVC,sBAAAA,UAAU,EAAE,MAFF;AAGVC,sBAAAA,UAAU,EAAE,CAHF;AAIVC,sBAAAA,WAAW,EAAE,CAJH;AAKVC,sBAAAA,KAAK,EAAE;AALG,qBADd;AAQE,oBAAA,KAAK,EAAE7E,MAAM,CAACK,MARhB;AASE,oBAAA,MAAM,EAAC;AATT;AAAA;AAAA;AAAA;AAAA,0BAFF;AAAA;AAAA;AAAA;AAAA;AAAA,wBAJF,eAmBE;AAAK,kBAAA,SAAS,EAAE3D,MAAM,CAAC8H,IAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAnBF,eAuBE;AAAK,kBAAA,SAAS,EAAE9H,MAAM,CAACoI,IAAvB;AAAA,yCACE;AAAK,oBAAA,SAAS,EAAEpI,MAAM,CAACqI,MAAvB;AAAA,2CACE,QAAC,MAAD;AACE,sBAAA,KAAK,MADP;AAEE,sBAAA,SAAS,EAAErI,MAAM,CAACsI,GAFpB;AAGE,sBAAA,IAAI,EAAC,SAHP;AAIE,sBAAA,IAAI,EAAC,OAJP;AAKE,sBAAA,OAAO,EAAEvB,SALX;AAME,sBAAA,OAAO,EAAEtB,cANX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,wBAvBF;AAAA;AAAA;AAAA;AAAA;AAAA,sBARJ,EA+CG,CAAClC,gBAAD,IAAqB,EAACD,MAAD,aAACA,MAAD,eAACA,MAAM,CAAEsE,MAAT,CAArB,iBACC;AAAK,gBAAA,SAAS,YAAK5H,MAAM,CAAC,YAAD,CAAX,gBAAd;AAAA,2BACG,CAAC4D,sBAAD,IAA2B3C,OAA3B,iBACC;AAAK,kBAAA,SAAS,EAAEjB,MAAM,CAACuI,MAAvB;AAAA,0CACE;AAAA,uEACSpJ,WAAW,CAAC8B,OAAO,CAACF,KAAT,EAAgB,IAAhB,CADpB;AAAA;AAAA;AAAA;AAAA;AAAA,0BADF,eAKE,QAAC,SAAD;AACE,oBAAA,UAAU,EAAE;AAAEgH,sBAAAA,QAAQ,EAAE,EAAZ;AAAgBE,sBAAAA,UAAU,EAAE;AAA5B,qBADd;AAEE,oBAAA,KAAK,EAAEhH,OAAO,CAAC0C,MAFjB;AAGE,oBAAA,MAAM,EAAC;AAHT;AAAA;AAAA;AAAA;AAAA,0BALF;AAAA;AAAA;AAAA;AAAA;AAAA,wBAFJ,EAcG,CAACC,sBAAD,IAA2B,CAAC3C,OAA5B,iBACC;AAAK,kBAAA,SAAS,EAAEjB,MAAM,CAACuI,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAfJ,EAiBG3E,sBAAsB,iBACrB;AAAK,kBAAA,SAAS,EAAE5D,MAAM,CAACuI,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAlBJ,eAoBE;AAAK,kBAAA,SAAS,EAAEvI,MAAM,CAACwI,KAAvB;AAAA,0CACE,QAAC,GAAD;AAAK,oBAAA,MAAM,EAAE,EAAb;AAAA,4CACE,QAAC,GAAD;AAAK,sBAAA,EAAE,EAAE,EAAT;AAAa,sBAAA,IAAI,EAAE,CAAChI,QAAD,GAAY,MAAZ,GAAqBkE,SAAxC;AAAA,6CACE,QAAC,UAAD;AACE,wBAAA,KAAK,EAAE3D,KADT;AAEE,wBAAA,QAAQ,EAAE,kBAACgF,KAAD;AAAA,iCAAW/E,QAAQ,CAAC+E,KAAD,CAAnB;AAAA,yBAFZ;AAGE,wBAAA,IAAI,EAAC,OAHP;AAIE,wBAAA,SAAS,EAAE,CAJb;AAKE,wBAAA,QAAQ,EAAE1E;AALZ;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,4BADF,eAUE,QAAC,GAAD;AAAK,sBAAA,EAAE,EAAE,CAAT;AAAY,sBAAA,IAAI,EAAE,CAACb,QAAD,GAAY,OAAZ,GAAsBkE,SAAxC;AAAA,6CACE,QAAC,MAAD;AACE,wBAAA,KAAK,MADP;AAEE,wBAAA,SAAS,EAAC,KAFZ;AAGE,wBAAA,IAAI,EAAC,SAHP;AAIE,wBAAA,IAAI,EAAC,OAJP;AAKE,wBAAA,OAAO,EAAErD,kBALX;AAME,wBAAA,OAAO,EAAEmF,MANX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,4BAVF;AAAA;AAAA;AAAA;AAAA;AAAA,0BADF,eAwBE;AAAK,oBAAA,SAAS,EAAExG,MAAM,CAAC8H,IAAvB;AAAA,4CACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAFF;AAAA;AAAA;AAAA;AAAA;AAAA,0BAxBF;AAAA;AAAA;AAAA;AAAA;AAAA,wBApBF;AAAA;AAAA;AAAA;AAAA;AAAA,sBAhDJ;AAAA,4BA5CJ,EAmJG,EAACvH,EAAD,aAACA,EAAD,eAACA,EAAE,CAAE+B,UAAL,kBACC;AAAK,cAAA,SAAS,EAAEtC,MAAM,CAACoI,IAAvB;AAAA,qCACE;AAAK,gBAAA,SAAS,EAAEpI,MAAM,CAACqI,MAAvB;AAAA,uCACE,QAAC,MAAD;AACE,kBAAA,KAAK,MADP;AAEE,kBAAA,IAAI,EAAC,SAFP;AAGE,kBAAA,IAAI,EAAC,OAHP;AAIE,kBAAA,OAAO,EAAE;AAAA,2BACPhI,MAAM,CAACoI,IAAP,CAAY;AACVC,sBAAAA,QAAQ,EAAE,QADA;AAEVpI,sBAAAA,KAAK,EAAE;AAAEqI,wBAAAA,GAAG,EAAEC,kBAAkB,CAACvI,MAAM,CAACwI,MAAR;AAAzB;AAFG,qBAAZ,CADO;AAAA,mBAJX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBApJJ,eAsKE;AAAK,cAAA,SAAS,EAAE7I,MAAM,CAAC8I,UAAvB;AAAA,qCACE,QAAC,GAAD;AAAK,gBAAA,MAAM,EAAE,CAAb;AAAA,wCACE,QAAC,GAAD;AAAK,kBAAA,EAAE,EAAE,CAAT;AAAY,kBAAA,IAAI,EAAE,CAAlB;AAAA,0CACE;AAAK,oBAAA,SAAS,EAAE9I,MAAM,CAAC2F,KAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BADF,eAEE;AAAK,oBAAA,SAAS,YAAK3F,MAAM,CAAC+I,KAAZ,cAAqB/I,MAAM,CAACgJ,KAA5B,CAAd;AAAA,+BACGjF,uBAAuB,IAAI,CAACD,QAA5B,iBACC,QAAC,IAAD;AACE,sBAAA,IAAI,EAAC,OADP;AAEE,sBAAA,SAAS,eACP,QAAC,eAAD;AAAiB,wBAAA,SAAS,EAAE9D,MAAM,CAAC0H;AAAnC;AAAA;AAAA;AAAA;AAAA;AAHJ;AAAA;AAAA;AAAA;AAAA,4BAFJ,EASG5D,QAAQ,iBACP;AAAA,8CACE;AAAA,kCAAOA,QAAQ,CAACmF;AAAhB;AAAA;AAAA;AAAA;AAAA,8BADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAFF;AAAA,oCAVJ;AAAA;AAAA;AAAA;AAAA;AAAA,0BAFF;AAAA;AAAA;AAAA;AAAA;AAAA,wBADF,eAoBE,QAAC,GAAD;AAAK,kBAAA,EAAE,EAAE,CAAT;AAAY,kBAAA,IAAI,EAAE,CAAlB;AAAA,0CACE;AAAK,oBAAA,SAAS,EAAEjJ,MAAM,CAAC2F,KAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BADF,eAEE;AAAK,oBAAA,SAAS,EAAE3F,MAAM,CAAC+I,KAAvB;AAAA,+BACGhF,uBAAuB,IAAI,CAACD,QAA5B,iBACC,QAAC,IAAD;AACE,sBAAA,IAAI,EAAC,OADP;AAEE,sBAAA,SAAS,eACP,QAAC,eAAD;AAAiB,wBAAA,SAAS,EAAE9D,MAAM,CAAC0H;AAAnC;AAAA;AAAA;AAAA;AAAA;AAHJ;AAAA;AAAA;AAAA;AAAA,4BAFJ,EASG5D,QAAQ,iBACP;AAAA,gCAAO3E,WAAW,CAAC2E,QAAQ,CAAC6D,SAAV,EAAqB,IAArB;AAAlB;AAAA;AAAA;AAAA;AAAA,4BAVJ;AAAA;AAAA;AAAA;AAAA;AAAA,0BAFF;AAAA;AAAA;AAAA;AAAA;AAAA,wBApBF,eAoCE,QAAC,GAAD;AAAK,kBAAA,EAAE,EAAE,CAAT;AAAY,kBAAA,IAAI,EAAE,CAAlB;AAAA,0CACE;AAAK,oBAAA,SAAS,EAAE3H,MAAM,CAAC2F,KAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BADF,eAEE;AAAK,oBAAA,SAAS,YAAK3F,MAAM,CAAC+I,KAAZ,cAAqB/I,MAAM,CAACkJ,IAA5B,CAAd;AAAA,+BACGnF,uBAAuB,IAAI,CAACD,QAA5B,iBACC,QAAC,IAAD;AACE,sBAAA,IAAI,EAAC,OADP;AAEE,sBAAA,SAAS,eACP,QAAC,eAAD;AAAiB,wBAAA,SAAS,EAAE9D,MAAM,CAAC0H;AAAnC;AAAA;AAAA;AAAA;AAAA;AAHJ;AAAA;AAAA;AAAA;AAAA,4BAFJ,EASG5D,QAAQ,iBACP;AAAA,gCAAO3E,WAAW,CAAC2E,QAAQ,CAACqF,YAAV,EAAwB,IAAxB;AAAlB;AAAA;AAAA;AAAA;AAAA,4BAVJ;AAAA;AAAA;AAAA;AAAA;AAAA,0BAFF;AAAA;AAAA;AAAA;AAAA;AAAA,wBApCF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBAtKF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBAbF;AAAA;AAAA;AAAA;AAAA;AAAA,cADF,eA+OE;AAAK,QAAA,SAAS,EAAEnJ,MAAM,CAACoJ,KAAvB;AAAA,gCACE,QAAC,KAAD;AACE,UAAA,KAAK,EAAE;AAAA,gCACL;AAAK,cAAA,SAAS,EAAEpJ,MAAM,CAACqJ,MAAvB;AAAA,kEAEE,QAAC,OAAD;AAAS,gBAAA,KAAK,EAAC,cAAf;AAAA,uCACE;AAAG,kBAAA,OAAO,EAAExC,eAAZ;AAAA,yCACE,QAAC,cAAD;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,uBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,qBADK;AAAA,WADT;AAWE,UAAA,OAAO,EAAEnB,OAXX;AAYE,UAAA,UAAU,EAAE,KAZd;AAaE,UAAA,MAAM,EAAC,IAbT;AAcE,UAAA,UAAU,EAAEjF,OAdd;AAeE,UAAA,MAAM,EAAED,QAAQ,GAAG;AAAE8I,YAAAA,CAAC,EAAE;AAAL,WAAH,GAAgB;AAflC;AAAA;AAAA;AAAA;AAAA,gBADF,EAkBG3I,cAAc,iBACb;AAAK,UAAA,SAAS,EAAEX,MAAM,CAACuJ,QAAvB;AAAA,qBACG,CAACpG,0BAAD,iBACC,QAAC,mBAAD;AACE,YAAA,SAAS,EAAEnD,MAAM,CAACwJ,IADpB;AAEE,YAAA,OAAO,EAAE5C;AAFX;AAAA;AAAA;AAAA;AAAA,kBAFJ,EAOGzD,0BAA0B,iBACzB,QAAC,IAAD;AAAM,YAAA,SAAS,eAAE,QAAC,eAAD;AAAA;AAAA;AAAA;AAAA;AAAjB;AAAA;AAAA;AAAA;AAAA,kBARJ;AAAA;AAAA;AAAA;AAAA;AAAA,gBAnBJ;AAAA;AAAA;AAAA;AAAA;AAAA,cA/OF;AAAA;AAAA;AAAA;AAAA;AAAA,YAvCF;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AA0TD;;GA1mBuBjD,M;UACPhC,S,EAEA0B,K,EACEC,W,EAuCbR,M,EAqBAA,M,EAM8DA,M,EAY1CA,M,EAWpBA,M,EAeAA,M,EAK0CA,M,EAgCAA,M,EA4BGA,M;;;KA7K3Ba,M","sourcesContent":["import { GetServerSideProps } from 'next'\nimport { useRouter } from 'next/router'\nimport { useEffect, useState } from 'react'\nimport {\n  Row,\n  Col,\n  Button,\n  Table,\n  TableColumnProps,\n  notification,\n  Space,\n  Statistic,\n  Spin,\n  Tooltip,\n  Tag\n} from 'antd'\nimport {\n  ShareAltOutlined,\n  DoubleRightOutlined,\n  LoadingOutlined,\n  ReloadOutlined\n} from '@ant-design/icons'\nimport { formatMoney } from 'accounting'\nimport moment from 'moment'\nimport useSWR from 'swr'\n\nimport Layout from '../../components/layout'\nimport Card from '../../components/card'\nimport PriceInput from '../../components/price-input'\nimport QuotedPriceModal from '../../components/quoted-price-modal'\nimport SellModal from '../../components/sell-modal'\nimport ShareModal from '../../components/share-modal'\nimport useMe from '../../hooks/use-me'\nimport useIsMobile from '../../hooks/use-is-mobile'\nimport fetchWeibo from '../../lib/fetch-weibo'\nimport fetchRecords from '../../lib/fetch-records'\nimport fetcher from '../../lib/fetcher'\nimport { CardDataType, CardStatus, StatDataType } from '../../typings/card'\nimport {\n  RecordItemDataType,\n  RecordItemTypeMap,\n  MyOfferType,\n  SellDataType,\n  WinResultType,\n  FinalDataType\n} from '../../typings/record'\nimport { PaymentUrlType } from '../../typings/payment'\nimport styles from '../../styles/detail.module.css'\n\nconst { Countdown } = Statistic\n\nexport interface DetailProps {\n  cardStatus: CardStatus\n  cardData?: CardDataType\n}\n\nexport default function Detail({ cardData, cardStatus }: DetailProps) {\n  const router = useRouter()\n  const { query } = router\n  const { me } = useMe()\n  const isMobile = useIsMobile()\n  const [records, setRecords] = useState<RecordItemDataType[]>([])\n  const [hasMoreRecords, setHasMoreRecords] = useState<boolean>(true)\n  const [recordsPage, setRecordsPage] = useState<number>(1)\n  const [price, setPrice] = useState<number>()\n  const [myOffer, setMyOffer] = useState<MyOfferType>()\n  const [sellData, setSellData] = useState<SellDataType>()\n  const [sendConfirmVisible, setSendConfirmVisible] = useState<boolean>(false)\n  const [sellConfirmVisible, setSellConfirmVisible] = useState<boolean>(false)\n  const [shareVisible, setShareVisible] = useState<boolean>(false)\n  const [shouldSendRequest, setShouldSendRequest] = useState<boolean>(false)\n  const [shouldSellRequest, setShouldSellRequest] = useState<boolean>(false)\n  const [shouldFetchMyOffer, setShouldFetchMyOffer] = useState<boolean>(false)\n  const [shouldFetchMoreRecords, setShouldFetchMoreRecords] = useState<boolean>(\n    true\n  )\n  const [shouldPaymentRequest, setShouldPaymentRequest] = useState<boolean>(\n    false\n  )\n\n  // 是原始发布者/创作者\n  const isCreator = me?.isLoggedIn && me.id === cardData?.creator?.id\n  // 是当前持有者\n  const isHolder = me?.isLoggedIn && me.id === cardData?.holder?.id\n  // 是否已经出售\n  const hasBeenSold = cardStatus === 1\n  // 是否可以购买\n  const canPurchased = me?.isLoggedIn && hasBeenSold ? !isHolder : !isCreator\n\n  useEffect(() => {\n    if (me?.isLoggedIn && !hasBeenSold) {\n      setShouldFetchMyOffer(true)\n    }\n  }, [hasBeenSold, me?.isLoggedIn])\n\n  // 加载更多交易记录请求\n  const {\n    isValidating: fetchMoreRecordsValidating = true,\n    mutate: mutateFetchMoreRecords\n  } = useSWR<RecordItemDataType[]>(\n    shouldFetchMoreRecords && hasMoreRecords\n      ? `/api/records?id=${query.id}&pageSize=20&current=${recordsPage}`\n      : null,\n    {\n      revalidateOnFocus: false,\n      onSuccess: (data) => {\n        setShouldFetchMoreRecords(false)\n        if (!data.length) {\n          setHasMoreRecords(false)\n          return\n        }\n        setRecords(recordsPage === 1 ? data : records.concat(data))\n      }\n    }\n  )\n\n  // 查询自己是否已中标\n  const {\n    data: hasWon,\n    isValidating: hasWonValidating\n  } = useSWR<WinResultType>(\n    me?.isLoggedIn && canPurchased ? `/api/my/win?id=${query.id}` : null,\n    { revalidateOnFocus: false }\n  )\n\n  // 查询已出售给谁\n  const { data: selling, isValidating: sellingValidating = true } = useSWR<\n    string[]\n  >(\n    !canPurchased && !fetchMoreRecordsValidating\n      ? `/api/selling?id=${query.id}`\n      : null,\n    {\n      revalidateOnFocus: false\n    }\n  )\n\n  // 查询当前成交价\n  const { data: final } = useSWR<FinalDataType>(\n    me?.isLoggedIn && hasBeenSold ? `/api/final?id=${query.id}` : null,\n    {\n      revalidateOnFocus: false\n    }\n  )\n\n  // 查询我的报价请求\n  const {\n    isValidating: fetchMyOfferValidating = true,\n    mutate: mutateFetchMyOffer\n  } = useSWR<MyOfferType>(\n    shouldFetchMyOffer ? `/api/my/offer?id=${query.id}` : null,\n    {\n      onSuccess: (data) => {\n        if (data.price && data.expire) setMyOffer(data)\n        setShouldFetchMyOffer(false)\n      }\n    }\n  )\n\n  // 查询统计数据请求\n  const {\n    data: statData,\n    isValidating: fetchStatDataValidating = true,\n    mutate: mutateFetchStatData\n  } = useSWR<StatDataType>(`/api/card/stat?id=${query.id}`, {\n    revalidateOnFocus: false\n  })\n\n  // 发送报价请求\n  const { isValidating: sendLoading = false } = useSWR(\n    shouldSendRequest ? '/api/offer' : null,\n    (url) =>\n      fetcher(url, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json; charset=utf-8' },\n        body: JSON.stringify({ id: query.id, price })\n      }),\n    {\n      revalidateOnFocus: false,\n      shouldRetryOnError: false,\n      onSuccess: () => {\n        notification.success({ message: '报价成功' })\n        setPrice(undefined)\n        setShouldSendRequest(false)\n        setSendConfirmVisible(false)\n        setShouldFetchMyOffer(true)\n        setShouldFetchMoreRecords(true)\n        setHasMoreRecords(true)\n        setRecordsPage(1)\n        mutateFetchMyOffer()\n        mutateFetchMoreRecords()\n        mutateFetchStatData()\n      },\n      onError: () => {\n        notification.error({ message: '报价发送失败，请重试' })\n        setShouldSendRequest(false)\n      }\n    }\n  )\n\n  // 出售给Ta请求\n  const { isValidating: sellLoading = false } = useSWR(\n    shouldSellRequest ? '/api/sell' : null,\n    (url) =>\n      fetcher(url, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json; charset=utf-8' },\n        body: JSON.stringify({ id: sellData?.id })\n      }),\n    {\n      revalidateOnFocus: false,\n      shouldRetryOnError: false,\n      onSuccess: () => {\n        notification.success({ message: '操作成功' })\n        setShouldSellRequest(false)\n        setSellConfirmVisible(false)\n        setShouldFetchMoreRecords(true)\n        setHasMoreRecords(true)\n        setRecordsPage(1)\n        mutateFetchMoreRecords()\n      },\n      onError: () => {\n        notification.error({ message: '操作失败，请重试' })\n        setShouldSellRequest(false)\n      }\n    }\n  )\n\n  // 获取付款链接请求\n  const { isValidating: paymentLoading = false } = useSWR<PaymentUrlType>(\n    shouldPaymentRequest ? '/api/payment' : null,\n    (url) =>\n      fetcher(url, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json; charset=utf-8' },\n        body: JSON.stringify({\n          orderId: hasWon?.orderId,\n          returnUrl: location.href\n        })\n      }),\n    {\n      revalidateOnFocus: false,\n      shouldRetryOnError: false,\n      onSuccess: (data) => {\n        setShouldPaymentRequest(false)\n        const a = document.createElement('a')\n        a.target = '_blank'\n        a.href = data.paymentUrl\n        a.click()\n      },\n      onError: () => {\n        notification.error({ message: '获取付款链接失败，请重试' })\n        setShouldPaymentRequest(false)\n      }\n    }\n  )\n\n  const columns: TableColumnProps<RecordItemDataType>[] = [\n    {\n      title: '类型',\n      key: 'type',\n      dataIndex: 'type',\n      render: (value) => RecordItemTypeMap[value]\n    },\n    {\n      title: '时间',\n      key: 'time',\n      dataIndex: 'time',\n      render: (value) => moment(value).format('YYYY/MM/DD HH:mm')\n    },\n    {\n      title: '用户昵称',\n      key: 'user.name',\n      dataIndex: ['user', 'name']\n    },\n    {\n      title: '金额',\n      key: 'price',\n      dataIndex: 'price',\n      render: (value) => formatMoney(value, '¥ ')\n    },\n    {\n      render: (_, item) => (\n        <>\n          {me?.isLoggedIn && !canPurchased && item.type === 0 && !item.expire && (\n            <div className={styles['table-action']}>\n              <Space>\n                {!sellingValidating && selling && selling.length === 0 && (\n                  <Button\n                    type=\"primary\"\n                    size=\"small\"\n                    shape=\"round\"\n                    onClick={() => {\n                      setSellData({\n                        id: item.id,\n                        price: item.price,\n                        name: item.user.name\n                      })\n                      setSellConfirmVisible(true)\n                    }}\n                  >\n                    出售给Ta\n                  </Button>\n                )}\n                {!sellingValidating &&\n                  selling &&\n                  selling.includes(item.user.id) && (\n                    <Tag color=\"#1858f9\">等待付款</Tag>\n                  )}\n              </Space>\n            </div>\n          )}\n          {me?.isLoggedIn && item.expire && (\n            <div className={styles['table-action']}>\n              <Space>\n                <Tag color=\"#000\" style={{ opacity: 0.3 }}>\n                  已过期\n                </Tag>\n              </Space>\n            </div>\n          )}\n        </>\n      )\n    }\n  ]\n\n  // 报价\n  const onSend = () => {\n    if (!price || price < 10 || String(price / 10).indexOf('.') !== -1) {\n      notification.error({\n        message: '报价金额必须是10的整数倍'\n      })\n      return\n    }\n    setSendConfirmVisible(true)\n  }\n\n  // 确认报价\n  const onSendOk = () => setShouldSendRequest(true)\n\n  // 加载更多交易记录\n  const onLoadMore = () => {\n    setRecordsPage(recordsPage + 1)\n    setShouldFetchMoreRecords(true)\n  }\n\n  // 刷新交易记录\n  const onReloadRecords = () => {\n    setShouldFetchMoreRecords(true)\n    setHasMoreRecords(true)\n    setRecordsPage(1)\n    mutateFetchMoreRecords()\n  }\n\n  // 确定出售给Ta\n  const onSellOk = () => setShouldSellRequest(true)\n\n  // 去支付\n  const onPayment = () => setShouldPaymentRequest(true)\n\n  return (\n    <Layout>\n      <ShareModal\n        visible={shareVisible}\n        cardData={cardData}\n        price={\n          hasBeenSold\n            ? final\n              ? final?.price\n              : undefined\n            : records.length !== 0\n            ? records[0].price\n            : undefined\n        }\n        time={\n          hasBeenSold\n            ? final\n              ? final?.time\n              : undefined\n            : records.length !== 0\n            ? records[0].time\n            : undefined\n        }\n        onClose={() => setShareVisible(false)}\n      />\n      <SellModal\n        price={sellData?.price}\n        name={sellData?.name}\n        visible={sellConfirmVisible}\n        loading={sellLoading}\n        onOk={onSellOk}\n        onCancel={() => setSellConfirmVisible(false)}\n      />\n      <QuotedPriceModal\n        price={price}\n        visible={sendConfirmVisible}\n        loading={sendLoading}\n        onOk={onSendOk}\n        onCancel={() => setSendConfirmVisible(false)}\n      />\n      <div className=\"container\">\n        <Row gutter={{ xs: 0, sm: 6 }} className={styles.showcase}>\n          <Col xs={24} sm={9}>\n            <Card arrows type=\"simple\" photoPreview={false} data={cardData} />\n          </Col>\n          <Col xs={24} sm={1}>\n            <div className={styles.tools}>\n              <Button\n                className={styles.btn}\n                onClick={() => setShareVisible(true)}\n                icon={<ShareAltOutlined size={18} />}\n              />\n            </div>\n          </Col>\n          <Col xs={24} sm={14}>\n            <div className={styles.main}>\n              <div className={styles.users}>\n                <div className={styles.u}>\n                  Creator:\n                  <span>{cardData?.creator ? cardData.creator.name : '-'}</span>\n                </div>\n                {cardData?.holder &&\n                  cardData.creator.id !== cardData.holder.id && (\n                    <div className={styles.u}>\n                      Holder:\n                      <span>{cardData.holder.name}</span>\n                    </div>\n                  )}\n              </div>\n              {/* {me?.isLoggedIn && hasBeenSold && (\n                <div className={styles['price-info']}>\n                  <div className={styles.title}>成交价格：</div>\n                  <div className={styles.high}>\n                    {finalValidating && !final && (\n                      <Spin\n                        indicator={<LoadingOutlined className={styles.spin} />}\n                      />\n                    )}\n                    {final && <>{formatMoney(final.price, '¥ ')}</>}\n                  </div>\n                  <div className={styles.help}>\n                    此卡片已出售，再看看其他的吧！\n                  </div>\n                </div>\n              )} */}\n              {me?.isLoggedIn && !canPurchased && (\n                <div className={styles['price-info']}>\n                  <div className={styles.title}>最高报价：</div>\n                  <div className={styles.high}>\n                    {fetchStatDataValidating && !statData && (\n                      <Spin\n                        indicator={<LoadingOutlined className={styles.spin} />}\n                      />\n                    )}\n                    {statData && <>{formatMoney(statData.highPrice, '¥ ')}</>}\n                  </div>\n                </div>\n              )}\n              {me?.isLoggedIn && canPurchased && (\n                <>\n                  {hasWonValidating && (\n                    <Spin\n                      className={styles['main-loader']}\n                      indicator={<LoadingOutlined className={styles.spin} />}\n                    />\n                  )}\n                  {!hasWonValidating && hasWon?.result && hasWon.price && (\n                    <div className={styles.win}>\n                      <div className={styles.title}>\n                        你已中标！中标价格： {formatMoney(hasWon.price, '¥ ')}\n                      </div>\n                      <div className={styles.help}>\n                        请在\n                        <Countdown\n                          valueStyle={{\n                            fontSize: 14,\n                            fontWeight: 'bold',\n                            marginLeft: 5,\n                            marginRight: 5,\n                            color: '#1858f9'\n                          }}\n                          value={hasWon.expire}\n                          format=\"H 小时 m 分 s 秒\"\n                        />\n                        内付款\n                      </div>\n                      <div className={styles.help}>\n                        请在24小时内完成支付，24小时内未支付将扣除20分信誉分，\n                        信誉分低于60分将无法出价。\n                      </div>\n                      <div className={styles.btns}>\n                        <div className={styles.column}>\n                          <Button\n                            block\n                            className={styles.pay}\n                            type=\"primary\"\n                            size=\"large\"\n                            onClick={onPayment}\n                            loading={paymentLoading}\n                          >\n                            去支付\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                  {!hasWonValidating && !hasWon?.result && (\n                    <div className={`${styles['send-price']} send-price`}>\n                      {!fetchMyOfferValidating && myOffer && (\n                        <div className={styles.prompt}>\n                          <div>\n                            当前报价为：{formatMoney(myOffer.price, '¥ ')}\n                            ，有效期\n                          </div>\n                          <Countdown\n                            valueStyle={{ fontSize: 14, marginLeft: 5 }}\n                            value={myOffer.expire}\n                            format=\"H 小时 m 分 s 秒\"\n                          />\n                        </div>\n                      )}\n                      {!fetchMyOfferValidating && !myOffer && (\n                        <div className={styles.prompt}>当前暂无报价</div>\n                      )}\n                      {fetchMyOfferValidating && (\n                        <div className={styles.prompt}>获取你的报价中...</div>\n                      )}\n                      <div className={styles.input}>\n                        <Row gutter={18}>\n                          <Col xs={16} flex={!isMobile ? 'auto' : undefined}>\n                            <PriceInput\n                              value={price}\n                              onChange={(value) => setPrice(value)}\n                              size=\"large\"\n                              precision={0}\n                              disabled={sendConfirmVisible}\n                            />\n                          </Col>\n                          <Col xs={8} flex={!isMobile ? '150px' : undefined}>\n                            <Button\n                              block\n                              className=\"btn\"\n                              type=\"primary\"\n                              size=\"large\"\n                              loading={sendConfirmVisible}\n                              onClick={onSend}\n                            >\n                              报价\n                            </Button>\n                          </Col>\n                        </Row>\n                        <div className={styles.help}>\n                          <p>报价金额必须是10的整数倍</p>\n                          <p>\n                            如报价后中标，须在24小时内支付，逾期未付将扣除20信誉值\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </>\n              )}\n              {!me?.isLoggedIn && (\n                <div className={styles.btns}>\n                  <div className={styles.column}>\n                    <Button\n                      block\n                      type=\"primary\"\n                      size=\"large\"\n                      onClick={() =>\n                        router.push({\n                          pathname: '/login',\n                          query: { ref: encodeURIComponent(router.asPath) }\n                        })\n                      }\n                    >\n                      我 要 买\n                    </Button>\n                  </div>\n                </div>\n              )}\n              <div className={styles.statistics}>\n                <Row gutter={4}>\n                  <Col xs={6} span={8}>\n                    <div className={styles.title}>报价单数</div>\n                    <div className={`${styles.count} ${styles.first}`}>\n                      {fetchStatDataValidating && !statData && (\n                        <Spin\n                          size=\"small\"\n                          indicator={\n                            <LoadingOutlined className={styles.spin} />\n                          }\n                        />\n                      )}\n                      {statData && (\n                        <>\n                          <span>{statData.offerTotal}</span>\n                          <i>单</i>\n                        </>\n                      )}\n                    </div>\n                  </Col>\n                  <Col xs={9} span={8}>\n                    <div className={styles.title}>报价最高金额</div>\n                    <div className={styles.count}>\n                      {fetchStatDataValidating && !statData && (\n                        <Spin\n                          size=\"small\"\n                          indicator={\n                            <LoadingOutlined className={styles.spin} />\n                          }\n                        />\n                      )}\n                      {statData && (\n                        <span>{formatMoney(statData.highPrice, '¥ ')}</span>\n                      )}\n                    </div>\n                  </Col>\n                  <Col xs={9} span={8}>\n                    <div className={styles.title}>报价平均金额</div>\n                    <div className={`${styles.count} ${styles.last}`}>\n                      {fetchStatDataValidating && !statData && (\n                        <Spin\n                          size=\"small\"\n                          indicator={\n                            <LoadingOutlined className={styles.spin} />\n                          }\n                        />\n                      )}\n                      {statData && (\n                        <span>{formatMoney(statData.averagePrice, '¥ ')}</span>\n                      )}\n                    </div>\n                  </Col>\n                </Row>\n              </div>\n            </div>\n          </Col>\n        </Row>\n        <div className={styles.table}>\n          <Table\n            title={() => (\n              <div className={styles.header}>\n                交易记录\n                <Tooltip title=\"刷新\">\n                  <a onClick={onReloadRecords}>\n                    <ReloadOutlined />\n                  </a>\n                </Tooltip>\n              </div>\n            )}\n            columns={columns}\n            pagination={false}\n            rowKey=\"id\"\n            dataSource={records}\n            scroll={isMobile ? { x: 700 } : {}}\n          />\n          {hasMoreRecords && (\n            <div className={styles.loadmore}>\n              {!fetchMoreRecordsValidating && (\n                <DoubleRightOutlined\n                  className={styles.icon}\n                  onClick={onLoadMore}\n                />\n              )}\n              {fetchMoreRecordsValidating && (\n                <Spin indicator={<LoadingOutlined />} />\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </Layout>\n  )\n}\n\nexport const getServerSideProps: GetServerSideProps<\n  DetailProps,\n  { id: string }\n> = async ({ params }) => {\n  if (params?.id.length !== 16 || !/^[0-9]+$/.test(params.id)) {\n    return { notFound: true }\n  }\n\n  let state: DetailProps = {\n    cardStatus: 0\n  }\n\n  let holder\n\n  try {\n    const records = await fetchRecords(params.id)\n    const { ownerId, ownerName } = records\n\n    if (ownerId && ownerName) {\n      state = {\n        ...state,\n        cardStatus: 1\n      }\n      holder = {\n        id: ownerId,\n        name: ownerName\n      }\n    }\n  } catch (error) {\n    console.error(error)\n  }\n\n  try {\n    const weibo = await fetchWeibo(params.id)\n    if (weibo) {\n      const weiboData = weibo.data.data\n      state = {\n        ...state,\n        cardData: {\n          id: weiboData.id,\n          creator: {\n            id: weiboData.user.id.toString(),\n            avatar: weiboData.user.profile_image_url,\n            name: weiboData.user.screen_name\n          },\n          content: weiboData.text,\n          // .replace('https://', `${process.env.API_BASE}/sinaimg/`)\n          thumbnails: weiboData.pics\n            ? weiboData.pics.map((item: any) => item.url)\n            : [],\n          repostsCount: weiboData.reposts_count,\n          commentsCount: weiboData.comments_count,\n          attitudesCount: weiboData.attitudes_count\n        }\n      }\n      if (holder && state.cardData) {\n        state.cardData.holder = holder\n      }\n    }\n  } catch (error) {\n    console.error(error)\n  }\n\n  return { props: state }\n}\n"]},"metadata":{},"sourceType":"module"}