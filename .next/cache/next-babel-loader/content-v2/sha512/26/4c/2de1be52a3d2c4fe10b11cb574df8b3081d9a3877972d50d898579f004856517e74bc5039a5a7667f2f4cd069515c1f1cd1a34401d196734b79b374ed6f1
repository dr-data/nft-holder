{"ast":null,"code":"import withSession from '../../../lib/session';\nimport fetchMySelling from '../../../lib/fetch-my-selling';\n\nconst recordsHandler = async (req, res) => {\n  const {\n    method,\n    query,\n    session\n  } = req;\n  const {\n    pageSize = 10,\n    current = 1\n  } = query;\n  const sessionToken = session === null || session === void 0 ? void 0 : session.get('token');\n\n  if (!sessionToken) {\n    res.status(401).end();\n    return;\n  }\n\n  switch (method) {\n    case 'GET':\n      {\n        try {\n          const data = await fetchMySelling(sessionToken.uid, sessionToken.token, Number(pageSize), Number(current));\n\n          if (data.list) {\n            console.log('========> selling');\n            console.log(data.list);\n            res.status(200).json([...data.list.map(item => ({\n              id: item.data.data.id,\n              creator: {\n                id: item.data.data.user.id.toString(),\n                avatar: item.data.data.user.profile_image_url,\n                name: item.data.data.user.screen_name\n              },\n              quotedPrice: {\n                top: item.amount\n              },\n              content: item.data.data.text,\n              thumbnails: item.data.data.pics ? item.data.data.pics.map(item => item.url) : [],\n              repostsCount: item.data.data.reposts_count,\n              commentsCount: item.data.data.comments_count,\n              attitudesCount: item.data.data.attitudes_count\n            }))]);\n            return;\n          }\n\n          res.status(204).end();\n        } catch (error) {\n          console.error(error);\n          res.status(error.status).end();\n        }\n\n        break;\n      }\n\n    default:\n      res.setHeader('Allow', ['GET']);\n      res.status(405).end(`Method ${method} Not Allowed`);\n  }\n};\n\nexport default withSession(recordsHandler);","map":{"version":3,"sources":["/Users/joker/Desktop/ink/work/nft-holder/pages/api/user/selling.ts"],"names":["withSession","fetchMySelling","recordsHandler","req","res","method","query","session","pageSize","current","sessionToken","get","status","end","data","uid","token","Number","list","console","log","json","map","item","id","creator","user","toString","avatar","profile_image_url","name","screen_name","quotedPrice","top","amount","content","text","thumbnails","pics","url","repostsCount","reposts_count","commentsCount","comments_count","attitudesCount","attitudes_count","error","setHeader"],"mappings":"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","sourcesContent":["import { NextApiRequest, NextApiResponse } from 'next'\nimport { Session } from 'next-iron-session'\n\nimport withSession from '../../../lib/session'\nimport fetchMySelling from '../../../lib/fetch-my-selling'\nimport { AccessTokenInfo } from '../../../typings/user'\nimport { MyCardsItemType } from '../../../typings/card'\n\nconst recordsHandler = async (\n  req: NextApiRequest & { session?: Session },\n  res: NextApiResponse<MyCardsItemType[]>\n) => {\n  const { method, query, session } = req\n  const { pageSize = 10, current = 1 } = query\n\n  const sessionToken = session?.get<AccessTokenInfo>('token')\n  if (!sessionToken) {\n    res.status(401).end()\n    return\n  }\n\n  switch (method) {\n    case 'GET': {\n      try {\n        const data = await fetchMySelling(\n          sessionToken.uid,\n          sessionToken.token,\n          Number(pageSize),\n          Number(current)\n        )\n        if (data.list) {\n          console.log('========> selling')\n          console.log(data.list)\n          res.status(200).json([\n            ...data.list.map((item: any) => ({\n              id: item.data.data.id,\n              creator: {\n                id: item.data.data.user.id.toString(),\n                avatar: item.data.data.user.profile_image_url,\n                name: item.data.data.user.screen_name\n              },\n              quotedPrice: { top: item.amount },\n              content: item.data.data.text,\n              thumbnails: item.data.data.pics\n                ? item.data.data.pics.map((item: any) => item.url)\n                : [],\n              repostsCount: item.data.data.reposts_count,\n              commentsCount: item.data.data.comments_count,\n              attitudesCount: item.data.data.attitudes_count\n            }))\n          ])\n          return\n        }\n        res.status(204).end()\n      } catch (error) {\n        console.error(error)\n        res.status(error.status).end()\n      }\n      break\n    }\n    default:\n      res.setHeader('Allow', ['GET'])\n      res.status(405).end(`Method ${method} Not Allowed`)\n  }\n}\n\nexport default withSession(recordsHandler)\n"]},"metadata":{},"sourceType":"module"}