{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/joker/Desktop/ink/work/nft-holder/pages/detail/[id].tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useRouter } from 'next/router';\nimport { useEffect, useState } from 'react';\nimport { Row, Col, Button, Table, notification, Space, Statistic, Spin, Tooltip, Tag } from 'antd';\nimport { ShareAltOutlined, DoubleRightOutlined, LoadingOutlined, ReloadOutlined } from '@ant-design/icons';\nimport { formatMoney } from 'accounting';\nimport moment from 'moment';\nimport useSWR from 'swr';\nimport Layout from '../../components/layout';\nimport Card from '../../components/card';\nimport PriceInput from '../../components/price-input';\nimport QuotedPriceModal from '../../components/quoted-price-modal';\nimport SellModal from '../../components/sell-modal';\nimport ShareModal from '../../components/share-modal';\nimport useMe from '../../hooks/use-me';\nimport useIsMobile from '../../hooks/use-is-mobile';\nimport fetchWeibo from '../../lib/fetch-weibo';\nimport fetchRecords from '../../lib/fetch-records';\nimport fetcher from '../../lib/fetcher';\nimport { RecordItemTypeMap } from '../../typings/record';\nimport styles from '../../styles/detail.module.css';\nconst {\n  Countdown\n} = Statistic;\nexport default function Detail({\n  cardData,\n  cardStatus\n}) {\n  var _cardData$creator, _cardData$holder;\n\n  const router = useRouter();\n  const {\n    query\n  } = router;\n  const {\n    me\n  } = useMe();\n  const isMobile = useIsMobile();\n  const {\n    0: records,\n    1: setRecords\n  } = useState([]);\n  const {\n    0: hasMoreRecords,\n    1: setHasMoreRecords\n  } = useState(true);\n  const {\n    0: recordsPage,\n    1: setRecordsPage\n  } = useState(1);\n  const {\n    0: price,\n    1: setPrice\n  } = useState();\n  const {\n    0: myOffer,\n    1: setMyOffer\n  } = useState();\n  const {\n    0: sellData,\n    1: setSellData\n  } = useState();\n  const {\n    0: sendConfirmVisible,\n    1: setSendConfirmVisible\n  } = useState(false);\n  const {\n    0: sellConfirmVisible,\n    1: setSellConfirmVisible\n  } = useState(false);\n  const {\n    0: shareVisible,\n    1: setShareVisible\n  } = useState(false);\n  const {\n    0: shouldSendRequest,\n    1: setShouldSendRequest\n  } = useState(false);\n  const {\n    0: shouldSellRequest,\n    1: setShouldSellRequest\n  } = useState(false);\n  const {\n    0: shouldFetchMyOffer,\n    1: setShouldFetchMyOffer\n  } = useState(false);\n  const {\n    0: shouldFetchMoreRecords,\n    1: setShouldFetchMoreRecords\n  } = useState(true);\n  const {\n    0: shouldPaymentRequest,\n    1: setShouldPaymentRequest\n  } = useState(false); // 是原始发布者/创作者\n\n  const isCreator = (me === null || me === void 0 ? void 0 : me.isLoggedIn) && me.id === (cardData === null || cardData === void 0 ? void 0 : (_cardData$creator = cardData.creator) === null || _cardData$creator === void 0 ? void 0 : _cardData$creator.id); // 是当前持有者\n\n  const isHolder = (me === null || me === void 0 ? void 0 : me.isLoggedIn) && me.id === (cardData === null || cardData === void 0 ? void 0 : (_cardData$holder = cardData.holder) === null || _cardData$holder === void 0 ? void 0 : _cardData$holder.id); // 是否已经出售\n\n  const hasBeenSold = cardStatus === 1; // 是否可以购买\n\n  const canPurchased = me !== null && me !== void 0 && me.isLoggedIn && hasBeenSold ? !isHolder : !isCreator;\n  useEffect(() => {\n    if (me !== null && me !== void 0 && me.isLoggedIn && !hasBeenSold) {\n      setShouldFetchMyOffer(true);\n    }\n  }, [hasBeenSold, me === null || me === void 0 ? void 0 : me.isLoggedIn]); // 加载更多交易记录请求\n\n  const {\n    isValidating: fetchMoreRecordsValidating = true,\n    mutate: mutateFetchMoreRecords\n  } = useSWR(shouldFetchMoreRecords && hasMoreRecords ? `/api/records?id=${query.id}&pageSize=20&current=${recordsPage}` : null, {\n    revalidateOnFocus: false,\n    onSuccess: data => {\n      setShouldFetchMoreRecords(false);\n\n      if (!data.length) {\n        setHasMoreRecords(false);\n        return;\n      }\n\n      setRecords(recordsPage === 1 ? data : records.concat(data));\n    }\n  }); // 查询自己是否已中标\n\n  const {\n    data: hasWon,\n    isValidating: hasWonValidating\n  } = useSWR(me !== null && me !== void 0 && me.isLoggedIn && canPurchased ? `/api/my/win?id=${query.id}` : null, {\n    revalidateOnFocus: false\n  }); // 查询已出售给谁\n\n  const {\n    data: selling,\n    isValidating: sellingValidating = true\n  } = useSWR(!canPurchased && !fetchMoreRecordsValidating ? `/api/selling?id=${query.id}` : null, {\n    revalidateOnFocus: false\n  }); // 查询当前成交价\n\n  const {\n    data: final\n  } = useSWR(me !== null && me !== void 0 && me.isLoggedIn && hasBeenSold ? `/api/final?id=${query.id}` : null, {\n    revalidateOnFocus: false\n  }); // 查询我的报价请求\n\n  const {\n    isValidating: fetchMyOfferValidating = true,\n    mutate: mutateFetchMyOffer\n  } = useSWR(shouldFetchMyOffer ? `/api/my/offer?id=${query.id}` : null, {\n    onSuccess: data => {\n      if (data.price && data.expire) setMyOffer(data);\n      setShouldFetchMyOffer(false);\n    }\n  }); // 查询统计数据请求\n\n  const {\n    data: statData,\n    isValidating: fetchStatDataValidating = true,\n    mutate: mutateFetchStatData\n  } = useSWR(`/api/card/stat?id=${query.id}`, {\n    revalidateOnFocus: false\n  }); // 发送报价请求\n\n  const {\n    isValidating: sendLoading = false\n  } = useSWR(shouldSendRequest ? '/api/offer' : null, url => fetcher(url, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json; charset=utf-8'\n    },\n    body: JSON.stringify({\n      id: query.id,\n      price\n    })\n  }), {\n    revalidateOnFocus: false,\n    shouldRetryOnError: false,\n    onSuccess: () => {\n      notification.success({\n        message: '报价成功'\n      });\n      setPrice(undefined);\n      setShouldSendRequest(false);\n      setSendConfirmVisible(false);\n      setShouldFetchMyOffer(true);\n      setShouldFetchMoreRecords(true);\n      setHasMoreRecords(true);\n      setRecordsPage(1);\n      mutateFetchMyOffer();\n      mutateFetchMoreRecords();\n      mutateFetchStatData();\n    },\n    onError: () => {\n      notification.error({\n        message: '报价发送失败，请重试'\n      });\n      setShouldSendRequest(false);\n    }\n  }); // 出售给Ta请求\n\n  const {\n    isValidating: sellLoading = false\n  } = useSWR(shouldSellRequest ? '/api/sell' : null, url => fetcher(url, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json; charset=utf-8'\n    },\n    body: JSON.stringify({\n      id: sellData === null || sellData === void 0 ? void 0 : sellData.id\n    })\n  }), {\n    revalidateOnFocus: false,\n    shouldRetryOnError: false,\n    onSuccess: () => {\n      notification.success({\n        message: '操作成功'\n      });\n      setShouldSellRequest(false);\n      setSellConfirmVisible(false);\n      setShouldFetchMoreRecords(true);\n      setHasMoreRecords(true);\n      setRecordsPage(1);\n      mutateFetchMoreRecords();\n    },\n    onError: () => {\n      notification.error({\n        message: '操作失败，请重试'\n      });\n      setShouldSellRequest(false);\n    }\n  }); // 获取付款链接请求\n\n  const {\n    isValidating: paymentLoading = false\n  } = useSWR(shouldPaymentRequest ? '/api/payment' : null, url => fetcher(url, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json; charset=utf-8'\n    },\n    body: JSON.stringify({\n      orderId: hasWon === null || hasWon === void 0 ? void 0 : hasWon.orderId,\n      returnUrl: location.href\n    })\n  }), {\n    revalidateOnFocus: false,\n    shouldRetryOnError: false,\n    onSuccess: data => {\n      setShouldPaymentRequest(false);\n      const a = document.createElement('a');\n      a.target = '_blank';\n      a.href = data.paymentUrl;\n      a.click();\n    },\n    onError: () => {\n      notification.error({\n        message: '获取付款链接失败，请重试'\n      });\n      setShouldPaymentRequest(false);\n    }\n  });\n  const columns = [{\n    title: '类型',\n    key: 'type',\n    dataIndex: 'type',\n    render: value => RecordItemTypeMap[value]\n  }, {\n    title: '时间',\n    key: 'time',\n    dataIndex: 'time',\n    render: value => moment(value).format('YYYY/MM/DD HH:mm')\n  }, {\n    title: '用户昵称',\n    key: 'user.name',\n    dataIndex: ['user', 'name']\n  }, {\n    title: '金额',\n    key: 'price',\n    dataIndex: 'price',\n    render: value => formatMoney(value, '¥ ')\n  }, {\n    render: (_, item) => /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [(me === null || me === void 0 ? void 0 : me.isLoggedIn) && !canPurchased && item.type === 0 && !item.expire && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles['table-action'],\n        children: /*#__PURE__*/_jsxDEV(Space, {\n          children: [!sellingValidating && selling && selling.length === 0 && /*#__PURE__*/_jsxDEV(Button, {\n            type: \"primary\",\n            size: \"small\",\n            shape: \"round\",\n            onClick: () => {\n              setSellData({\n                id: item.id,\n                price: item.price,\n                name: item.user.name\n              });\n              setSellConfirmVisible(true);\n            },\n            children: \"\\u51FA\\u552E\\u7ED9Ta\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 289,\n            columnNumber: 19\n          }, this), !sellingValidating && selling && selling.includes(item.user.id) && /*#__PURE__*/_jsxDEV(Tag, {\n            color: \"#1858f9\",\n            children: \"\\u7B49\\u5F85\\u4ED8\\u6B3E\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 13\n      }, this), (me === null || me === void 0 ? void 0 : me.isLoggedIn) && item.expire && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles['table-action'],\n        children: /*#__PURE__*/_jsxDEV(Space, {\n          children: /*#__PURE__*/_jsxDEV(Tag, {\n            color: \"#000\",\n            style: {\n              opacity: 0.3\n            },\n            children: \"\\u5DF2\\u8FC7\\u671F\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 316,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 315,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 314,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true)\n  }]; // 报价\n\n  const onSend = () => {\n    if (!price || price < 10 || String(price / 10).indexOf('.') !== -1) {\n      notification.error({\n        message: '报价金额必须是10的整数倍'\n      });\n      return;\n    }\n\n    setSendConfirmVisible(true);\n  }; // 确认报价\n\n\n  const onSendOk = () => setShouldSendRequest(true); // 加载更多交易记录\n\n\n  const onLoadMore = () => {\n    setRecordsPage(recordsPage + 1);\n    setShouldFetchMoreRecords(true);\n  }; // 刷新交易记录\n\n\n  const onReloadRecords = () => {\n    setShouldFetchMoreRecords(true);\n    setHasMoreRecords(true);\n    setRecordsPage(1);\n    mutateFetchMoreRecords();\n  }; // 确定出售给Ta\n\n\n  const onSellOk = () => setShouldSellRequest(true); // 去支付\n\n\n  const onPayment = () => setShouldPaymentRequest(true);\n\n  return /*#__PURE__*/_jsxDEV(Layout, {\n    children: [/*#__PURE__*/_jsxDEV(ShareModal, {\n      visible: shareVisible,\n      cardData: cardData,\n      price: hasBeenSold ? final ? final === null || final === void 0 ? void 0 : final.price : undefined : records.length !== 0 ? records[0].price : undefined,\n      time: hasBeenSold ? final ? final === null || final === void 0 ? void 0 : final.time : undefined : records.length !== 0 ? records[0].time : undefined,\n      onClose: () => setShareVisible(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(SellModal, {\n      price: sellData === null || sellData === void 0 ? void 0 : sellData.price,\n      name: sellData === null || sellData === void 0 ? void 0 : sellData.name,\n      visible: sellConfirmVisible,\n      loading: sellLoading,\n      onOk: onSellOk,\n      onCancel: () => setSellConfirmVisible(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 386,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(QuotedPriceModal, {\n      price: price,\n      visible: sendConfirmVisible,\n      loading: sendLoading,\n      onOk: onSendOk,\n      onCancel: () => setSendConfirmVisible(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(Row, {\n        gutter: {\n          xs: 0,\n          sm: 6\n        },\n        className: styles.showcase,\n        children: [/*#__PURE__*/_jsxDEV(Col, {\n          xs: 24,\n          sm: 9,\n          children: /*#__PURE__*/_jsxDEV(Card, {\n            arrows: true,\n            type: \"simple\",\n            photoPreview: false,\n            data: cardData\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 404,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 403,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          xs: 24,\n          sm: 1,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: styles.tools,\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              className: styles.btn,\n              onClick: () => setShareVisible(true),\n              icon: /*#__PURE__*/_jsxDEV(ShareAltOutlined, {\n                size: 18\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 411,\n                columnNumber: 23\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 408,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 407,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 406,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          xs: 24,\n          sm: 14,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: styles.main,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: styles.users,\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.u,\n                children: [\"Creator:\", /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: cardData !== null && cardData !== void 0 && cardData.creator ? cardData.creator.name : '-'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 420,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 418,\n                columnNumber: 17\n              }, this), (cardData === null || cardData === void 0 ? void 0 : cardData.holder) && cardData.creator.id !== cardData.holder.id && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.u,\n                children: [\"Holder:\", /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: cardData.holder.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 426,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 424,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 417,\n              columnNumber: 15\n            }, this), (me === null || me === void 0 ? void 0 : me.isLoggedIn) && !canPurchased && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: styles['price-info'],\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.title,\n                children: \"\\u6700\\u9AD8\\u62A5\\u4EF7\\uFF1A\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 448,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.high,\n                children: [fetchStatDataValidating && !statData && /*#__PURE__*/_jsxDEV(Spin, {\n                  indicator: /*#__PURE__*/_jsxDEV(LoadingOutlined, {\n                    className: styles.spin\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 452,\n                    columnNumber: 36\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 451,\n                  columnNumber: 23\n                }, this), statData && /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: formatMoney(statData.highPrice, '¥ ')\n                }, void 0, false)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 449,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 447,\n              columnNumber: 17\n            }, this), (me === null || me === void 0 ? void 0 : me.isLoggedIn) && canPurchased && /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [hasWonValidating && /*#__PURE__*/_jsxDEV(Spin, {\n                className: styles['main-loader'],\n                indicator: /*#__PURE__*/_jsxDEV(LoadingOutlined, {\n                  className: styles.spin\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 464,\n                  columnNumber: 34\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 462,\n                columnNumber: 21\n              }, this), !hasWonValidating && (hasWon === null || hasWon === void 0 ? void 0 : hasWon.result) && hasWon.price && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.win,\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.title,\n                  children: [\"\\u4F60\\u5DF2\\u4E2D\\u6807\\uFF01\\u4E2D\\u6807\\u4EF7\\u683C\\uFF1A \", formatMoney(hasWon.price, '¥ ')]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 469,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.help,\n                  children: [\"\\u8BF7\\u5728\", /*#__PURE__*/_jsxDEV(Countdown, {\n                    valueStyle: {\n                      fontSize: 14,\n                      fontWeight: 'bold',\n                      marginLeft: 5,\n                      marginRight: 5,\n                      color: '#1858f9'\n                    },\n                    value: hasWon.expire,\n                    format: \"H \\u5C0F\\u65F6 m \\u5206 s \\u79D2\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 474,\n                    columnNumber: 25\n                  }, this), \"\\u5185\\u4ED8\\u6B3E\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 472,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.help,\n                  children: \"\\u8BF7\\u572824\\u5C0F\\u65F6\\u5185\\u5B8C\\u6210\\u652F\\u4ED8\\uFF0C24\\u5C0F\\u65F6\\u5185\\u672A\\u652F\\u4ED8\\u5C06\\u6263\\u966420\\u5206\\u4FE1\\u8A89\\u5206\\uFF0C \\u4FE1\\u8A89\\u5206\\u4F4E\\u4E8E60\\u5206\\u5C06\\u65E0\\u6CD5\\u51FA\\u4EF7\\u3002\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 487,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.btns,\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.column,\n                    children: /*#__PURE__*/_jsxDEV(Button, {\n                      block: true,\n                      className: styles.pay,\n                      type: \"primary\",\n                      size: \"large\",\n                      onClick: onPayment,\n                      loading: paymentLoading,\n                      children: \"\\u53BB\\u652F\\u4ED8\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 493,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 492,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 491,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 468,\n                columnNumber: 21\n              }, this), !hasWonValidating && !(hasWon !== null && hasWon !== void 0 && hasWon.result) && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: `${styles['send-price']} send-price`,\n                children: [!fetchMyOfferValidating && myOffer && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.prompt,\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    children: [\"\\u5F53\\u524D\\u62A5\\u4EF7\\u4E3A\\uFF1A\", formatMoney(myOffer.price, '¥ '), \"\\uFF0C\\u6709\\u6548\\u671F\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 511,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(Countdown, {\n                    valueStyle: {\n                      fontSize: 14,\n                      marginLeft: 5\n                    },\n                    value: myOffer.expire,\n                    format: \"H \\u5C0F\\u65F6 m \\u5206 s \\u79D2\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 515,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 510,\n                  columnNumber: 25\n                }, this), !fetchMyOfferValidating && !myOffer && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.prompt,\n                  children: \"\\u5F53\\u524D\\u6682\\u65E0\\u62A5\\u4EF7\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 523,\n                  columnNumber: 25\n                }, this), fetchMyOfferValidating && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.prompt,\n                  children: \"\\u83B7\\u53D6\\u4F60\\u7684\\u62A5\\u4EF7\\u4E2D...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 526,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: styles.input,\n                  children: [/*#__PURE__*/_jsxDEV(Row, {\n                    gutter: 18,\n                    children: [/*#__PURE__*/_jsxDEV(Col, {\n                      xs: 16,\n                      flex: !isMobile ? 'auto' : undefined,\n                      children: /*#__PURE__*/_jsxDEV(PriceInput, {\n                        value: price,\n                        onChange: value => setPrice(value),\n                        size: \"large\",\n                        precision: 0,\n                        disabled: sendConfirmVisible\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 531,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 530,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(Col, {\n                      xs: 8,\n                      flex: !isMobile ? '150px' : undefined,\n                      children: /*#__PURE__*/_jsxDEV(Button, {\n                        block: true,\n                        className: \"btn\",\n                        type: \"primary\",\n                        size: \"large\",\n                        loading: sendConfirmVisible,\n                        onClick: onSend,\n                        children: \"\\u62A5\\u4EF7\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 540,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 539,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 529,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.help,\n                    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                      children: \"\\u62A5\\u4EF7\\u91D1\\u989D\\u5FC5\\u987B\\u662F10\\u7684\\u6574\\u6570\\u500D\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 553,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      children: \"\\u5982\\u62A5\\u4EF7\\u540E\\u4E2D\\u6807\\uFF0C\\u987B\\u572824\\u5C0F\\u65F6\\u5185\\u652F\\u4ED8\\uFF0C\\u903E\\u671F\\u672A\\u4ED8\\u5C06\\u6263\\u966420\\u4FE1\\u8A89\\u503C\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 554,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 552,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 528,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 508,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true), !(me !== null && me !== void 0 && me.isLoggedIn) && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: styles.btns,\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.column,\n                children: /*#__PURE__*/_jsxDEV(Button, {\n                  block: true,\n                  type: \"primary\",\n                  size: \"large\",\n                  onClick: () => router.push({\n                    pathname: '/login',\n                    query: {\n                      ref: encodeURIComponent(router.asPath)\n                    }\n                  }),\n                  children: \"\\u6211 \\u8981 \\u4E70\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 566,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 565,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 564,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: styles.statistics,\n              children: /*#__PURE__*/_jsxDEV(Row, {\n                gutter: 4,\n                children: [/*#__PURE__*/_jsxDEV(Col, {\n                  xs: 6,\n                  span: 8,\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.title,\n                    children: \"\\u62A5\\u4EF7\\u5355\\u6570\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 585,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `${styles.count} ${styles.first}`,\n                    children: [fetchStatDataValidating && !statData && /*#__PURE__*/_jsxDEV(Spin, {\n                      size: \"small\",\n                      indicator: /*#__PURE__*/_jsxDEV(LoadingOutlined, {\n                        className: styles.spin\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 591,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 588,\n                      columnNumber: 25\n                    }, this), statData && /*#__PURE__*/_jsxDEV(_Fragment, {\n                      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                        children: statData.offerTotal\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 597,\n                        columnNumber: 27\n                      }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n                        children: \"\\u5355\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 598,\n                        columnNumber: 27\n                      }, this)]\n                    }, void 0, true)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 586,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 584,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  xs: 9,\n                  span: 8,\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.title,\n                    children: \"\\u62A5\\u4EF7\\u6700\\u9AD8\\u91D1\\u989D\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 604,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.count,\n                    children: [fetchStatDataValidating && !statData && /*#__PURE__*/_jsxDEV(Spin, {\n                      size: \"small\",\n                      indicator: /*#__PURE__*/_jsxDEV(LoadingOutlined, {\n                        className: styles.spin\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 610,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 607,\n                      columnNumber: 25\n                    }, this), statData && /*#__PURE__*/_jsxDEV(\"span\", {\n                      children: formatMoney(statData.highPrice, '¥ ')\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 615,\n                      columnNumber: 25\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 605,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 603,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  xs: 9,\n                  span: 8,\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.title,\n                    children: \"\\u62A5\\u4EF7\\u5E73\\u5747\\u91D1\\u989D\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 620,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `${styles.count} ${styles.last}`,\n                    children: [fetchStatDataValidating && !statData && /*#__PURE__*/_jsxDEV(Spin, {\n                      size: \"small\",\n                      indicator: /*#__PURE__*/_jsxDEV(LoadingOutlined, {\n                        className: styles.spin\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 626,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 623,\n                      columnNumber: 25\n                    }, this), statData && /*#__PURE__*/_jsxDEV(\"span\", {\n                      children: formatMoney(statData.averagePrice, '¥ ')\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 631,\n                      columnNumber: 25\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 621,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 619,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 583,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 582,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 415,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.table,\n        children: [/*#__PURE__*/_jsxDEV(Table, {\n          title: () => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: styles.header,\n            children: [\"\\u4EA4\\u6613\\u8BB0\\u5F55\", /*#__PURE__*/_jsxDEV(Tooltip, {\n              title: \"\\u5237\\u65B0\",\n              children: /*#__PURE__*/_jsxDEV(\"a\", {\n                onClick: onReloadRecords,\n                children: /*#__PURE__*/_jsxDEV(ReloadOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 647,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 646,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 645,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 643,\n            columnNumber: 15\n          }, this),\n          columns: columns,\n          pagination: false,\n          rowKey: \"id\",\n          dataSource: records,\n          scroll: isMobile ? {\n            x: 700\n          } : {}\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 641,\n          columnNumber: 11\n        }, this), hasMoreRecords && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.loadmore,\n          children: [!fetchMoreRecordsValidating && /*#__PURE__*/_jsxDEV(DoubleRightOutlined, {\n            className: styles.icon,\n            onClick: onLoadMore\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 661,\n            columnNumber: 17\n          }, this), fetchMoreRecordsValidating && /*#__PURE__*/_jsxDEV(Spin, {\n            indicator: /*#__PURE__*/_jsxDEV(LoadingOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 667,\n              columnNumber: 34\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 667,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 659,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 640,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 362,\n    columnNumber: 5\n  }, this);\n}\nexport const getServerSideProps = async ({\n  params\n}) => {\n  if ((params === null || params === void 0 ? void 0 : params.id.length) !== 16 || !/^[0-9]+$/.test(params.id)) {\n    return {\n      notFound: true\n    };\n  }\n\n  let state = {\n    cardStatus: 0\n  };\n  let holder;\n\n  try {\n    const records = await fetchRecords(params.id);\n    const {\n      ownerId,\n      ownerName\n    } = records;\n\n    if (ownerId && ownerName) {\n      state = _objectSpread(_objectSpread({}, state), {}, {\n        cardStatus: 1\n      });\n      holder = {\n        id: ownerId,\n        name: ownerName\n      };\n    }\n  } catch (error) {\n    console.error(error);\n  }\n\n  try {\n    const weibo = await fetchWeibo(params.id);\n\n    if (weibo) {\n      const weiboData = weibo.data.data;\n      state = _objectSpread(_objectSpread({}, state), {}, {\n        cardData: {\n          id: weiboData.id,\n          creator: {\n            id: weiboData.user.id.toString(),\n            avatar: weiboData.user.profile_image_url,\n            name: weiboData.user.screen_name\n          },\n          content: weiboData.text,\n          // .replace('https://', `${process.env.API_BASE}/sinaimg/`)\n          thumbnails: weiboData.pics ? weiboData.pics.map(item => item.url) : [],\n          repostsCount: weiboData.reposts_count,\n          commentsCount: weiboData.comments_count,\n          attitudesCount: weiboData.attitudes_count\n        }\n      });\n\n      if (holder && state.cardData) {\n        state.cardData.holder = holder;\n      }\n    }\n  } catch (error) {\n    console.error(error);\n  }\n\n  return {\n    props: state\n  };\n};","map":{"version":3,"sources":["/Users/joker/Desktop/ink/work/nft-holder/pages/detail/[id].tsx"],"names":["useRouter","useEffect","useState","Row","Col","Button","Table","notification","Space","Statistic","Spin","Tooltip","Tag","ShareAltOutlined","DoubleRightOutlined","LoadingOutlined","ReloadOutlined","formatMoney","moment","useSWR","Layout","Card","PriceInput","QuotedPriceModal","SellModal","ShareModal","useMe","useIsMobile","fetchWeibo","fetchRecords","fetcher","RecordItemTypeMap","styles","Countdown","Detail","cardData","cardStatus","router","query","me","isMobile","records","setRecords","hasMoreRecords","setHasMoreRecords","recordsPage","setRecordsPage","price","setPrice","myOffer","setMyOffer","sellData","setSellData","sendConfirmVisible","setSendConfirmVisible","sellConfirmVisible","setSellConfirmVisible","shareVisible","setShareVisible","shouldSendRequest","setShouldSendRequest","shouldSellRequest","setShouldSellRequest","shouldFetchMyOffer","setShouldFetchMyOffer","shouldFetchMoreRecords","setShouldFetchMoreRecords","shouldPaymentRequest","setShouldPaymentRequest","isCreator","isLoggedIn","id","creator","isHolder","holder","hasBeenSold","canPurchased","isValidating","fetchMoreRecordsValidating","mutate","mutateFetchMoreRecords","revalidateOnFocus","onSuccess","data","length","concat","hasWon","hasWonValidating","selling","sellingValidating","final","fetchMyOfferValidating","mutateFetchMyOffer","expire","statData","fetchStatDataValidating","mutateFetchStatData","sendLoading","url","method","headers","body","JSON","stringify","shouldRetryOnError","success","message","undefined","onError","error","sellLoading","paymentLoading","orderId","returnUrl","location","href","a","document","createElement","target","paymentUrl","click","columns","title","key","dataIndex","render","value","format","_","item","type","name","user","includes","opacity","onSend","String","indexOf","onSendOk","onLoadMore","onReloadRecords","onSellOk","onPayment","time","xs","sm","showcase","tools","btn","main","users","u","high","spin","highPrice","result","win","help","fontSize","fontWeight","marginLeft","marginRight","color","btns","column","pay","prompt","input","push","pathname","ref","encodeURIComponent","asPath","statistics","count","first","offerTotal","last","averagePrice","table","header","x","loadmore","icon","getServerSideProps","params","test","notFound","state","ownerId","ownerName","console","weibo","weiboData","toString","avatar","profile_image_url","screen_name","content","text","thumbnails","pics","map","repostsCount","reposts_count","commentsCount","comments_count","attitudesCount","attitudes_count","props"],"mappings":"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","sourcesContent":["import { GetServerSideProps } from 'next'\nimport { useRouter } from 'next/router'\nimport { useEffect, useState } from 'react'\nimport {\n  Row,\n  Col,\n  Button,\n  Table,\n  TableColumnProps,\n  notification,\n  Space,\n  Statistic,\n  Spin,\n  Tooltip,\n  Tag\n} from 'antd'\nimport {\n  ShareAltOutlined,\n  DoubleRightOutlined,\n  LoadingOutlined,\n  ReloadOutlined\n} from '@ant-design/icons'\nimport { formatMoney } from 'accounting'\nimport moment from 'moment'\nimport useSWR from 'swr'\n\nimport Layout from '../../components/layout'\nimport Card from '../../components/card'\nimport PriceInput from '../../components/price-input'\nimport QuotedPriceModal from '../../components/quoted-price-modal'\nimport SellModal from '../../components/sell-modal'\nimport ShareModal from '../../components/share-modal'\nimport useMe from '../../hooks/use-me'\nimport useIsMobile from '../../hooks/use-is-mobile'\nimport fetchWeibo from '../../lib/fetch-weibo'\nimport fetchRecords from '../../lib/fetch-records'\nimport fetcher from '../../lib/fetcher'\nimport { CardDataType, CardStatus, StatDataType } from '../../typings/card'\nimport {\n  RecordItemDataType,\n  RecordItemTypeMap,\n  MyOfferType,\n  SellDataType,\n  WinResultType,\n  FinalDataType\n} from '../../typings/record'\nimport { PaymentUrlType } from '../../typings/payment'\nimport styles from '../../styles/detail.module.css'\n\nconst { Countdown } = Statistic\n\nexport interface DetailProps {\n  cardStatus: CardStatus\n  cardData?: CardDataType\n}\n\nexport default function Detail({ cardData, cardStatus }: DetailProps) {\n  const router = useRouter()\n  const { query } = router\n  const { me } = useMe()\n  const isMobile = useIsMobile()\n  const [records, setRecords] = useState<RecordItemDataType[]>([])\n  const [hasMoreRecords, setHasMoreRecords] = useState<boolean>(true)\n  const [recordsPage, setRecordsPage] = useState<number>(1)\n  const [price, setPrice] = useState<number>()\n  const [myOffer, setMyOffer] = useState<MyOfferType>()\n  const [sellData, setSellData] = useState<SellDataType>()\n  const [sendConfirmVisible, setSendConfirmVisible] = useState<boolean>(false)\n  const [sellConfirmVisible, setSellConfirmVisible] = useState<boolean>(false)\n  const [shareVisible, setShareVisible] = useState<boolean>(false)\n  const [shouldSendRequest, setShouldSendRequest] = useState<boolean>(false)\n  const [shouldSellRequest, setShouldSellRequest] = useState<boolean>(false)\n  const [shouldFetchMyOffer, setShouldFetchMyOffer] = useState<boolean>(false)\n  const [shouldFetchMoreRecords, setShouldFetchMoreRecords] = useState<boolean>(\n    true\n  )\n  const [shouldPaymentRequest, setShouldPaymentRequest] = useState<boolean>(\n    false\n  )\n\n  // 是原始发布者/创作者\n  const isCreator = me?.isLoggedIn && me.id === cardData?.creator?.id\n  // 是当前持有者\n  const isHolder = me?.isLoggedIn && me.id === cardData?.holder?.id\n  // 是否已经出售\n  const hasBeenSold = cardStatus === 1\n  // 是否可以购买\n  const canPurchased = me?.isLoggedIn && hasBeenSold ? !isHolder : !isCreator\n\n  useEffect(() => {\n    if (me?.isLoggedIn && !hasBeenSold) {\n      setShouldFetchMyOffer(true)\n    }\n  }, [hasBeenSold, me?.isLoggedIn])\n\n  // 加载更多交易记录请求\n  const {\n    isValidating: fetchMoreRecordsValidating = true,\n    mutate: mutateFetchMoreRecords\n  } = useSWR<RecordItemDataType[]>(\n    shouldFetchMoreRecords && hasMoreRecords\n      ? `/api/records?id=${query.id}&pageSize=20&current=${recordsPage}`\n      : null,\n    {\n      revalidateOnFocus: false,\n      onSuccess: (data) => {\n        setShouldFetchMoreRecords(false)\n        if (!data.length) {\n          setHasMoreRecords(false)\n          return\n        }\n        setRecords(recordsPage === 1 ? data : records.concat(data))\n      }\n    }\n  )\n\n  // 查询自己是否已中标\n  const {\n    data: hasWon,\n    isValidating: hasWonValidating\n  } = useSWR<WinResultType>(\n    me?.isLoggedIn && canPurchased ? `/api/my/win?id=${query.id}` : null,\n    { revalidateOnFocus: false }\n  )\n\n  // 查询已出售给谁\n  const { data: selling, isValidating: sellingValidating = true } = useSWR<\n    string[]\n  >(\n    !canPurchased && !fetchMoreRecordsValidating\n      ? `/api/selling?id=${query.id}`\n      : null,\n    {\n      revalidateOnFocus: false\n    }\n  )\n\n  // 查询当前成交价\n  const { data: final } = useSWR<FinalDataType>(\n    me?.isLoggedIn && hasBeenSold ? `/api/final?id=${query.id}` : null,\n    {\n      revalidateOnFocus: false\n    }\n  )\n\n  // 查询我的报价请求\n  const {\n    isValidating: fetchMyOfferValidating = true,\n    mutate: mutateFetchMyOffer\n  } = useSWR<MyOfferType>(\n    shouldFetchMyOffer ? `/api/my/offer?id=${query.id}` : null,\n    {\n      onSuccess: (data) => {\n        if (data.price && data.expire) setMyOffer(data)\n        setShouldFetchMyOffer(false)\n      }\n    }\n  )\n\n  // 查询统计数据请求\n  const {\n    data: statData,\n    isValidating: fetchStatDataValidating = true,\n    mutate: mutateFetchStatData\n  } = useSWR<StatDataType>(`/api/card/stat?id=${query.id}`, {\n    revalidateOnFocus: false\n  })\n\n  // 发送报价请求\n  const { isValidating: sendLoading = false } = useSWR(\n    shouldSendRequest ? '/api/offer' : null,\n    (url) =>\n      fetcher(url, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json; charset=utf-8' },\n        body: JSON.stringify({ id: query.id, price })\n      }),\n    {\n      revalidateOnFocus: false,\n      shouldRetryOnError: false,\n      onSuccess: () => {\n        notification.success({ message: '报价成功' })\n        setPrice(undefined)\n        setShouldSendRequest(false)\n        setSendConfirmVisible(false)\n        setShouldFetchMyOffer(true)\n        setShouldFetchMoreRecords(true)\n        setHasMoreRecords(true)\n        setRecordsPage(1)\n        mutateFetchMyOffer()\n        mutateFetchMoreRecords()\n        mutateFetchStatData()\n      },\n      onError: () => {\n        notification.error({ message: '报价发送失败，请重试' })\n        setShouldSendRequest(false)\n      }\n    }\n  )\n\n  // 出售给Ta请求\n  const { isValidating: sellLoading = false } = useSWR(\n    shouldSellRequest ? '/api/sell' : null,\n    (url) =>\n      fetcher(url, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json; charset=utf-8' },\n        body: JSON.stringify({ id: sellData?.id })\n      }),\n    {\n      revalidateOnFocus: false,\n      shouldRetryOnError: false,\n      onSuccess: () => {\n        notification.success({ message: '操作成功' })\n        setShouldSellRequest(false)\n        setSellConfirmVisible(false)\n        setShouldFetchMoreRecords(true)\n        setHasMoreRecords(true)\n        setRecordsPage(1)\n        mutateFetchMoreRecords()\n      },\n      onError: () => {\n        notification.error({ message: '操作失败，请重试' })\n        setShouldSellRequest(false)\n      }\n    }\n  )\n\n  // 获取付款链接请求\n  const { isValidating: paymentLoading = false } = useSWR<PaymentUrlType>(\n    shouldPaymentRequest ? '/api/payment' : null,\n    (url) =>\n      fetcher(url, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json; charset=utf-8' },\n        body: JSON.stringify({\n          orderId: hasWon?.orderId,\n          returnUrl: location.href\n        })\n      }),\n    {\n      revalidateOnFocus: false,\n      shouldRetryOnError: false,\n      onSuccess: (data) => {\n        setShouldPaymentRequest(false)\n        const a = document.createElement('a')\n        a.target = '_blank'\n        a.href = data.paymentUrl\n        a.click()\n      },\n      onError: () => {\n        notification.error({ message: '获取付款链接失败，请重试' })\n        setShouldPaymentRequest(false)\n      }\n    }\n  )\n\n  const columns: TableColumnProps<RecordItemDataType>[] = [\n    {\n      title: '类型',\n      key: 'type',\n      dataIndex: 'type',\n      render: (value) => RecordItemTypeMap[value]\n    },\n    {\n      title: '时间',\n      key: 'time',\n      dataIndex: 'time',\n      render: (value) => moment(value).format('YYYY/MM/DD HH:mm')\n    },\n    {\n      title: '用户昵称',\n      key: 'user.name',\n      dataIndex: ['user', 'name']\n    },\n    {\n      title: '金额',\n      key: 'price',\n      dataIndex: 'price',\n      render: (value) => formatMoney(value, '¥ ')\n    },\n    {\n      render: (_, item) => (\n        <>\n          {me?.isLoggedIn && !canPurchased && item.type === 0 && !item.expire && (\n            <div className={styles['table-action']}>\n              <Space>\n                {!sellingValidating && selling && selling.length === 0 && (\n                  <Button\n                    type=\"primary\"\n                    size=\"small\"\n                    shape=\"round\"\n                    onClick={() => {\n                      setSellData({\n                        id: item.id,\n                        price: item.price,\n                        name: item.user.name\n                      })\n                      setSellConfirmVisible(true)\n                    }}\n                  >\n                    出售给Ta\n                  </Button>\n                )}\n                {!sellingValidating &&\n                  selling &&\n                  selling.includes(item.user.id) && (\n                    <Tag color=\"#1858f9\">等待付款</Tag>\n                  )}\n              </Space>\n            </div>\n          )}\n          {me?.isLoggedIn && item.expire && (\n            <div className={styles['table-action']}>\n              <Space>\n                <Tag color=\"#000\" style={{ opacity: 0.3 }}>\n                  已过期\n                </Tag>\n              </Space>\n            </div>\n          )}\n        </>\n      )\n    }\n  ]\n\n  // 报价\n  const onSend = () => {\n    if (!price || price < 10 || String(price / 10).indexOf('.') !== -1) {\n      notification.error({\n        message: '报价金额必须是10的整数倍'\n      })\n      return\n    }\n    setSendConfirmVisible(true)\n  }\n\n  // 确认报价\n  const onSendOk = () => setShouldSendRequest(true)\n\n  // 加载更多交易记录\n  const onLoadMore = () => {\n    setRecordsPage(recordsPage + 1)\n    setShouldFetchMoreRecords(true)\n  }\n\n  // 刷新交易记录\n  const onReloadRecords = () => {\n    setShouldFetchMoreRecords(true)\n    setHasMoreRecords(true)\n    setRecordsPage(1)\n    mutateFetchMoreRecords()\n  }\n\n  // 确定出售给Ta\n  const onSellOk = () => setShouldSellRequest(true)\n\n  // 去支付\n  const onPayment = () => setShouldPaymentRequest(true)\n\n  return (\n    <Layout>\n      <ShareModal\n        visible={shareVisible}\n        cardData={cardData}\n        price={\n          hasBeenSold\n            ? final\n              ? final?.price\n              : undefined\n            : records.length !== 0\n            ? records[0].price\n            : undefined\n        }\n        time={\n          hasBeenSold\n            ? final\n              ? final?.time\n              : undefined\n            : records.length !== 0\n            ? records[0].time\n            : undefined\n        }\n        onClose={() => setShareVisible(false)}\n      />\n      <SellModal\n        price={sellData?.price}\n        name={sellData?.name}\n        visible={sellConfirmVisible}\n        loading={sellLoading}\n        onOk={onSellOk}\n        onCancel={() => setSellConfirmVisible(false)}\n      />\n      <QuotedPriceModal\n        price={price}\n        visible={sendConfirmVisible}\n        loading={sendLoading}\n        onOk={onSendOk}\n        onCancel={() => setSendConfirmVisible(false)}\n      />\n      <div className=\"container\">\n        <Row gutter={{ xs: 0, sm: 6 }} className={styles.showcase}>\n          <Col xs={24} sm={9}>\n            <Card arrows type=\"simple\" photoPreview={false} data={cardData} />\n          </Col>\n          <Col xs={24} sm={1}>\n            <div className={styles.tools}>\n              <Button\n                className={styles.btn}\n                onClick={() => setShareVisible(true)}\n                icon={<ShareAltOutlined size={18} />}\n              />\n            </div>\n          </Col>\n          <Col xs={24} sm={14}>\n            <div className={styles.main}>\n              <div className={styles.users}>\n                <div className={styles.u}>\n                  Creator:\n                  <span>{cardData?.creator ? cardData.creator.name : '-'}</span>\n                </div>\n                {cardData?.holder &&\n                  cardData.creator.id !== cardData.holder.id && (\n                    <div className={styles.u}>\n                      Holder:\n                      <span>{cardData.holder.name}</span>\n                    </div>\n                  )}\n              </div>\n              {/* {me?.isLoggedIn && hasBeenSold && (\n                <div className={styles['price-info']}>\n                  <div className={styles.title}>成交价格：</div>\n                  <div className={styles.high}>\n                    {finalValidating && !final && (\n                      <Spin\n                        indicator={<LoadingOutlined className={styles.spin} />}\n                      />\n                    )}\n                    {final && <>{formatMoney(final.price, '¥ ')}</>}\n                  </div>\n                  <div className={styles.help}>\n                    此卡片已出售，再看看其他的吧！\n                  </div>\n                </div>\n              )} */}\n              {me?.isLoggedIn && !canPurchased && (\n                <div className={styles['price-info']}>\n                  <div className={styles.title}>最高报价：</div>\n                  <div className={styles.high}>\n                    {fetchStatDataValidating && !statData && (\n                      <Spin\n                        indicator={<LoadingOutlined className={styles.spin} />}\n                      />\n                    )}\n                    {statData && <>{formatMoney(statData.highPrice, '¥ ')}</>}\n                  </div>\n                </div>\n              )}\n              {me?.isLoggedIn && canPurchased && (\n                <>\n                  {hasWonValidating && (\n                    <Spin\n                      className={styles['main-loader']}\n                      indicator={<LoadingOutlined className={styles.spin} />}\n                    />\n                  )}\n                  {!hasWonValidating && hasWon?.result && hasWon.price && (\n                    <div className={styles.win}>\n                      <div className={styles.title}>\n                        你已中标！中标价格： {formatMoney(hasWon.price, '¥ ')}\n                      </div>\n                      <div className={styles.help}>\n                        请在\n                        <Countdown\n                          valueStyle={{\n                            fontSize: 14,\n                            fontWeight: 'bold',\n                            marginLeft: 5,\n                            marginRight: 5,\n                            color: '#1858f9'\n                          }}\n                          value={hasWon.expire}\n                          format=\"H 小时 m 分 s 秒\"\n                        />\n                        内付款\n                      </div>\n                      <div className={styles.help}>\n                        请在24小时内完成支付，24小时内未支付将扣除20分信誉分，\n                        信誉分低于60分将无法出价。\n                      </div>\n                      <div className={styles.btns}>\n                        <div className={styles.column}>\n                          <Button\n                            block\n                            className={styles.pay}\n                            type=\"primary\"\n                            size=\"large\"\n                            onClick={onPayment}\n                            loading={paymentLoading}\n                          >\n                            去支付\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                  {!hasWonValidating && !hasWon?.result && (\n                    <div className={`${styles['send-price']} send-price`}>\n                      {!fetchMyOfferValidating && myOffer && (\n                        <div className={styles.prompt}>\n                          <div>\n                            当前报价为：{formatMoney(myOffer.price, '¥ ')}\n                            ，有效期\n                          </div>\n                          <Countdown\n                            valueStyle={{ fontSize: 14, marginLeft: 5 }}\n                            value={myOffer.expire}\n                            format=\"H 小时 m 分 s 秒\"\n                          />\n                        </div>\n                      )}\n                      {!fetchMyOfferValidating && !myOffer && (\n                        <div className={styles.prompt}>当前暂无报价</div>\n                      )}\n                      {fetchMyOfferValidating && (\n                        <div className={styles.prompt}>获取你的报价中...</div>\n                      )}\n                      <div className={styles.input}>\n                        <Row gutter={18}>\n                          <Col xs={16} flex={!isMobile ? 'auto' : undefined}>\n                            <PriceInput\n                              value={price}\n                              onChange={(value) => setPrice(value)}\n                              size=\"large\"\n                              precision={0}\n                              disabled={sendConfirmVisible}\n                            />\n                          </Col>\n                          <Col xs={8} flex={!isMobile ? '150px' : undefined}>\n                            <Button\n                              block\n                              className=\"btn\"\n                              type=\"primary\"\n                              size=\"large\"\n                              loading={sendConfirmVisible}\n                              onClick={onSend}\n                            >\n                              报价\n                            </Button>\n                          </Col>\n                        </Row>\n                        <div className={styles.help}>\n                          <p>报价金额必须是10的整数倍</p>\n                          <p>\n                            如报价后中标，须在24小时内支付，逾期未付将扣除20信誉值\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </>\n              )}\n              {!me?.isLoggedIn && (\n                <div className={styles.btns}>\n                  <div className={styles.column}>\n                    <Button\n                      block\n                      type=\"primary\"\n                      size=\"large\"\n                      onClick={() =>\n                        router.push({\n                          pathname: '/login',\n                          query: { ref: encodeURIComponent(router.asPath) }\n                        })\n                      }\n                    >\n                      我 要 买\n                    </Button>\n                  </div>\n                </div>\n              )}\n              <div className={styles.statistics}>\n                <Row gutter={4}>\n                  <Col xs={6} span={8}>\n                    <div className={styles.title}>报价单数</div>\n                    <div className={`${styles.count} ${styles.first}`}>\n                      {fetchStatDataValidating && !statData && (\n                        <Spin\n                          size=\"small\"\n                          indicator={\n                            <LoadingOutlined className={styles.spin} />\n                          }\n                        />\n                      )}\n                      {statData && (\n                        <>\n                          <span>{statData.offerTotal}</span>\n                          <i>单</i>\n                        </>\n                      )}\n                    </div>\n                  </Col>\n                  <Col xs={9} span={8}>\n                    <div className={styles.title}>报价最高金额</div>\n                    <div className={styles.count}>\n                      {fetchStatDataValidating && !statData && (\n                        <Spin\n                          size=\"small\"\n                          indicator={\n                            <LoadingOutlined className={styles.spin} />\n                          }\n                        />\n                      )}\n                      {statData && (\n                        <span>{formatMoney(statData.highPrice, '¥ ')}</span>\n                      )}\n                    </div>\n                  </Col>\n                  <Col xs={9} span={8}>\n                    <div className={styles.title}>报价平均金额</div>\n                    <div className={`${styles.count} ${styles.last}`}>\n                      {fetchStatDataValidating && !statData && (\n                        <Spin\n                          size=\"small\"\n                          indicator={\n                            <LoadingOutlined className={styles.spin} />\n                          }\n                        />\n                      )}\n                      {statData && (\n                        <span>{formatMoney(statData.averagePrice, '¥ ')}</span>\n                      )}\n                    </div>\n                  </Col>\n                </Row>\n              </div>\n            </div>\n          </Col>\n        </Row>\n        <div className={styles.table}>\n          <Table\n            title={() => (\n              <div className={styles.header}>\n                交易记录\n                <Tooltip title=\"刷新\">\n                  <a onClick={onReloadRecords}>\n                    <ReloadOutlined />\n                  </a>\n                </Tooltip>\n              </div>\n            )}\n            columns={columns}\n            pagination={false}\n            rowKey=\"id\"\n            dataSource={records}\n            scroll={isMobile ? { x: 700 } : {}}\n          />\n          {hasMoreRecords && (\n            <div className={styles.loadmore}>\n              {!fetchMoreRecordsValidating && (\n                <DoubleRightOutlined\n                  className={styles.icon}\n                  onClick={onLoadMore}\n                />\n              )}\n              {fetchMoreRecordsValidating && (\n                <Spin indicator={<LoadingOutlined />} />\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </Layout>\n  )\n}\n\nexport const getServerSideProps: GetServerSideProps<\n  DetailProps,\n  { id: string }\n> = async ({ params }) => {\n  if (params?.id.length !== 16 || !/^[0-9]+$/.test(params.id)) {\n    return { notFound: true }\n  }\n\n  let state: DetailProps = {\n    cardStatus: 0\n  }\n\n  let holder\n\n  try {\n    const records = await fetchRecords(params.id)\n    const { ownerId, ownerName } = records\n\n    if (ownerId && ownerName) {\n      state = {\n        ...state,\n        cardStatus: 1\n      }\n      holder = {\n        id: ownerId,\n        name: ownerName\n      }\n    }\n  } catch (error) {\n    console.error(error)\n  }\n\n  try {\n    const weibo = await fetchWeibo(params.id)\n    if (weibo) {\n      const weiboData = weibo.data.data\n      state = {\n        ...state,\n        cardData: {\n          id: weiboData.id,\n          creator: {\n            id: weiboData.user.id.toString(),\n            avatar: weiboData.user.profile_image_url,\n            name: weiboData.user.screen_name\n          },\n          content: weiboData.text,\n          // .replace('https://', `${process.env.API_BASE}/sinaimg/`)\n          thumbnails: weiboData.pics\n            ? weiboData.pics.map((item: any) => item.url)\n            : [],\n          repostsCount: weiboData.reposts_count,\n          commentsCount: weiboData.comments_count,\n          attitudesCount: weiboData.attitudes_count\n        }\n      }\n      if (holder && state.cardData) {\n        state.cardData.holder = holder\n      }\n    }\n  } catch (error) {\n    console.error(error)\n  }\n\n  return { props: state }\n}\n"]},"metadata":{},"sourceType":"module"}