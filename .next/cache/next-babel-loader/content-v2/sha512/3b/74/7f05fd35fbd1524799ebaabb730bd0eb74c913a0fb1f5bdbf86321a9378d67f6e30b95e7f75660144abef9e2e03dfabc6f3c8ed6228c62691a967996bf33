{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/joker/Desktop/ink/work/nft-holder/pages/login.tsx\";\nimport { useRouter } from 'next/router';\nimport { Button, Alert } from 'antd';\nimport useSWR from 'swr';\nimport Layout from '../components/layout';\nimport useMe from '../hooks/use-me';\nimport styles from '../styles/login.module.css';\nexport default function Login() {\n  const router = useRouter();\n  const {\n    mutateMe\n  } = useMe();\n  const {\n    query\n  } = router;\n  const {\n    error: accessTokenError,\n    isValidating\n  } = useSWR(query.code ? `/api/login?code=${query.code}&redirect=${location.origin}/login` : null, {\n    revalidateOnFocus: false,\n    shouldRetryOnError: false,\n    onSuccess: () => {\n      mutateMe();\n      router.replace(query.state ? decodeURIComponent(query.state) : '/');\n    }\n  });\n\n  const loginWithWeibo = () => {\n    const weiboAppKey = process.env.NEXT_PUBLIC_WEIBO_APP_KEY || '';\n\n    if (weiboAppKey) {\n      const link = document.createElement('a');\n      link.href = `https://api.weibo.com/oauth2/authorize?client_id=${weiboAppKey}&redirect_uri=${location.origin}/login&response_type=code${query.ref ? `&state=${query.ref}` : ''}`;\n      link.click();\n      link.remove();\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(Layout, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.main,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.title,\n          children: \"\\u6388\\u6743 NFT-Holder \\u8BBF\\u95EE\\u4F60\\u7684\\u65B0\\u6D6A\\u5FAE\\u535A\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 46,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.subtitle,\n          children: \"\\u6388\\u6743\\u662F\\u4E3A\\u4E86\\u4F7F\\u7528\\u65B0\\u6D6A\\u5FAE\\u535A\\u7684 API\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 47,\n          columnNumber: 11\n        }, this), accessTokenError && !isValidating && /*#__PURE__*/_jsxDEV(Alert, {\n          style: {\n            marginTop: 40\n          },\n          message: accessTokenError + '',\n          description: \"\\u767B\\u5F55\\u5931\\u8D25\\uFF0C\\u8BF7\\u91CD\\u8BD5\",\n          type: \"error\",\n          closable: true,\n          showIcon: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 49,\n          columnNumber: 13\n        }, this), !query.code || accessTokenError ? /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          className: styles.btn,\n          loading: isValidating,\n          onClick: loginWithWeibo,\n          children: \"\\u4F7F\\u7528\\u5FAE\\u535A\\u8D26\\u53F7\\u767B\\u5F55\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 59,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(Alert, {\n          style: {\n            marginTop: 40\n          },\n          message: \"\\u6388\\u6743\\u767B\\u5F55\\u6210\\u529F\\uFF0C\\u6B63\\u5728\\u8DF3\\u8F6C...\",\n          type: \"success\",\n          showIcon: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.desc,\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"\\u6388\\u6743 NFT-Holder \\u53EF\\u4EE5\\uFF1A\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 76,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"\\u67E5\\u770B\\u4F60\\u65F6\\u95F4\\u7EBF\\u4E0A\\u7684\\u5FAE\\u535A\\u6D88\\u606F\\uFF08\\u5305\\u62EC\\u53D7\\u4FDD\\u62A4\\u7684\\uFF09\\u3002\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 79,\n              columnNumber: 15\n            }, this), \"\\u67E5\\u770B\\u4F60\\u7684 \\u5FAE\\u535A\\u4E2A\\u4EBA\\u8D44\\u6599\\u4FE1\\u606F\\u548C\\u8D26\\u53F7\\u8BBE\\u7F6E\\u3002\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 81,\n              columnNumber: 15\n            }, this), \"\\u67E5\\u770B\\u4F60\\u5173\\u6CE8\\u3001\\u9690\\u85CF\\u548C\\u5C4F\\u853D\\u7684\\u8D26\\u53F7\\u3002\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 83,\n              columnNumber: 15\n            }, this), \"\\u67E5\\u770B\\u4F60\\u7684\\u90AE\\u4EF6\\u5730\\u5740\\u3002\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 77,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 75,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 43,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"sources":["/Users/joker/Desktop/ink/work/nft-holder/pages/login.tsx"],"names":["useRouter","Button","Alert","useSWR","Layout","useMe","styles","Login","router","mutateMe","query","error","accessTokenError","isValidating","code","location","origin","revalidateOnFocus","shouldRetryOnError","onSuccess","replace","state","decodeURIComponent","loginWithWeibo","weiboAppKey","process","env","NEXT_PUBLIC_WEIBO_APP_KEY","link","document","createElement","href","ref","click","remove","main","title","subtitle","marginTop","btn","desc"],"mappings":"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","sourcesContent":["import { useRouter } from 'next/router'\nimport { Button, Alert } from 'antd'\nimport useSWR from 'swr'\n\nimport { AccessTokenInfo } from '../typings/user'\nimport Layout from '../components/layout'\nimport useMe from '../hooks/use-me'\nimport styles from '../styles/login.module.css'\n\nexport default function Login() {\n  const router = useRouter()\n  const { mutateMe } = useMe()\n  const { query } = router\n  const { error: accessTokenError, isValidating } = useSWR<AccessTokenInfo>(\n    query.code\n      ? `/api/login?code=${query.code}&redirect=${location.origin}/login`\n      : null,\n    {\n      revalidateOnFocus: false,\n      shouldRetryOnError: false,\n      onSuccess: () => {\n        mutateMe()\n        router.replace(\n          query.state ? decodeURIComponent(query.state as string) : '/'\n        )\n      }\n    }\n  )\n\n  const loginWithWeibo = () => {\n    const weiboAppKey = process.env.NEXT_PUBLIC_WEIBO_APP_KEY || ''\n    if (weiboAppKey) {\n      const link = document.createElement('a')\n      link.href = `https://api.weibo.com/oauth2/authorize?client_id=${weiboAppKey}&redirect_uri=${\n        location.origin\n      }/login&response_type=code${query.ref ? `&state=${query.ref}` : ''}`\n      link.click()\n      link.remove()\n    }\n  }\n\n  return (\n    <Layout>\n      <div className=\"container\">\n        <div className={styles.main}>\n          <div className={styles.title}>授权 NFT-Holder 访问你的新浪微博</div>\n          <div className={styles.subtitle}>授权是为了使用新浪微博的 API</div>\n          {accessTokenError && !isValidating && (\n            <Alert\n              style={{ marginTop: 40 }}\n              message={accessTokenError + ''}\n              description=\"登录失败，请重试\"\n              type=\"error\"\n              closable\n              showIcon\n            />\n          )}\n          {!query.code || accessTokenError ? (\n            <Button\n              type=\"primary\"\n              className={styles.btn}\n              loading={isValidating}\n              onClick={loginWithWeibo}\n            >\n              使用微博账号登录\n            </Button>\n          ) : (\n            <Alert\n              style={{ marginTop: 40 }}\n              message=\"授权登录成功，正在跳转...\"\n              type=\"success\"\n              showIcon\n            />\n          )}\n          <div className={styles.desc}>\n            <p>授权 NFT-Holder 可以：</p>\n            <p>\n              查看你时间线上的微博消息（包括受保护的）。\n              <br />\n              查看你的 微博个人资料信息和账号设置。\n              <br />\n              查看你关注、隐藏和屏蔽的账号。\n              <br />\n              查看你的邮件地址。\n            </p>\n          </div>\n        </div>\n      </div>\n    </Layout>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}