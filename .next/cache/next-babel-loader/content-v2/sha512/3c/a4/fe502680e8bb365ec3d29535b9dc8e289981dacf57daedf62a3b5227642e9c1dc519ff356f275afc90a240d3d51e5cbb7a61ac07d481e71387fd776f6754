{"ast":null,"code":"import withSession from '../../../lib/session';\n\nconst sellingHandler = async (req, res) => {\n  const {\n    method,\n    query,\n    session\n  } = req;\n  const {\n    id\n  } = query;\n  const sessionToken = session === null || session === void 0 ? void 0 : session.get('token');\n\n  if (!sessionToken) {\n    res.status(401).end();\n    return;\n  }\n\n  switch (method) {\n    case 'GET':\n      {\n        const result = await fetch(`${process.env.API_BASE}/api/v1/user/order/blog?bid=${id}`, {\n          headers: {\n            authorization: sessionToken.token\n          }\n        });\n        let data = null;\n\n        try {\n          data = await result.json();\n        } catch (error) {\n          console.error(error);\n        }\n\n        if (!result.ok) {\n          res.status(result.status).json(data);\n          return;\n        }\n\n        res.status(200).json(data ? {\n          result: true,\n          price: data.amount,\n          expire: data.time * 1000,\n          orderId: data.order_id\n        } : {\n          result: false\n        });\n        break;\n      }\n\n    default:\n      res.setHeader('Allow', ['GET']);\n      res.status(405).end(`Method ${method} Not Allowed`);\n  }\n};\n\nexport default withSession(sellingHandler);","map":{"version":3,"sources":["/Users/joker/Desktop/ink/work/nft-holder/pages/api/my/win.ts"],"names":["withSession","sellingHandler","req","res","method","query","session","id","sessionToken","get","status","end","result","fetch","process","env","API_BASE","headers","authorization","token","data","json","error","console","ok","price","amount","expire","time","orderId","order_id","setHeader"],"mappings":"AAGA,OAAOA,WAAP,MAAwB,sBAAxB;;AAIA,MAAMC,cAAc,GAAG,OACrBC,GADqB,EAErBC,GAFqB,KAGlB;AACH,QAAM;AAAEC,IAAAA,MAAF;AAAUC,IAAAA,KAAV;AAAiBC,IAAAA;AAAjB,MAA6BJ,GAAnC;AACA,QAAM;AAAEK,IAAAA;AAAF,MAASF,KAAf;AAEA,QAAMG,YAAY,GAAGF,OAAH,aAAGA,OAAH,uBAAGA,OAAO,CAAEG,GAAT,CAA8B,OAA9B,CAArB;;AACA,MAAI,CAACD,YAAL,EAAmB;AACjBL,IAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,GAAhB;AACA;AACD;;AAED,UAAQP,MAAR;AACE,SAAK,KAAL;AAAY;AACV,cAAMQ,MAAM,GAAG,MAAMC,KAAK,CACvB,GAAEC,OAAO,CAACC,GAAR,CAAYC,QAAS,+BAA8BT,EAAG,EADjC,EAExB;AACEU,UAAAA,OAAO,EAAE;AACPC,YAAAA,aAAa,EAAEV,YAAY,CAACW;AADrB;AADX,SAFwB,CAA1B;AAQA,YAAIC,IAAI,GAAG,IAAX;;AACA,YAAI;AACFA,UAAAA,IAAI,GAAG,MAAMR,MAAM,CAACS,IAAP,EAAb;AACD,SAFD,CAEE,OAAOC,KAAP,EAAc;AACdC,UAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACD;;AACD,YAAI,CAACV,MAAM,CAACY,EAAZ,EAAgB;AACdrB,UAAAA,GAAG,CAACO,MAAJ,CAAWE,MAAM,CAACF,MAAlB,EAA0BW,IAA1B,CAA+BD,IAA/B;AACA;AACD;;AACDjB,QAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBW,IAAhB,CACED,IAAI,GACA;AACER,UAAAA,MAAM,EAAE,IADV;AAEEa,UAAAA,KAAK,EAAEL,IAAI,CAACM,MAFd;AAGEC,UAAAA,MAAM,EAAEP,IAAI,CAACQ,IAAL,GAAY,IAHtB;AAIEC,UAAAA,OAAO,EAAET,IAAI,CAACU;AAJhB,SADA,GAOA;AAAElB,UAAAA,MAAM,EAAE;AAAV,SARN;AAUA;AACD;;AACD;AACET,MAAAA,GAAG,CAAC4B,SAAJ,CAAc,OAAd,EAAuB,CAAC,KAAD,CAAvB;AACA5B,MAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,GAAhB,CAAqB,UAASP,MAAO,cAArC;AAlCJ;AAoCD,CAjDD;;AAmDA,eAAeJ,WAAW,CAACC,cAAD,CAA1B","sourcesContent":["import { NextApiRequest, NextApiResponse } from 'next'\nimport { Session } from 'next-iron-session'\n\nimport withSession from '../../../lib/session'\nimport { AccessTokenInfo } from '../../../typings/user'\nimport { WinResultType } from '../../../typings/record'\n\nconst sellingHandler = async (\n  req: NextApiRequest & { session?: Session },\n  res: NextApiResponse<WinResultType>\n) => {\n  const { method, query, session } = req\n  const { id } = query\n\n  const sessionToken = session?.get<AccessTokenInfo>('token')\n  if (!sessionToken) {\n    res.status(401).end()\n    return\n  }\n\n  switch (method) {\n    case 'GET': {\n      const result = await fetch(\n        `${process.env.API_BASE}/api/v1/user/order/blog?bid=${id}`,\n        {\n          headers: {\n            authorization: sessionToken.token\n          }\n        }\n      )\n      let data = null\n      try {\n        data = await result.json()\n      } catch (error) {\n        console.error(error)\n      }\n      if (!result.ok) {\n        res.status(result.status).json(data)\n        return\n      }\n      res.status(200).json(\n        data\n          ? {\n              result: true,\n              price: data.amount,\n              expire: data.time * 1000,\n              orderId: data.order_id\n            }\n          : { result: false }\n      )\n      break\n    }\n    default:\n      res.setHeader('Allow', ['GET'])\n      res.status(405).end(`Method ${method} Not Allowed`)\n  }\n}\n\nexport default withSession(sellingHandler)\n"]},"metadata":{},"sourceType":"module"}